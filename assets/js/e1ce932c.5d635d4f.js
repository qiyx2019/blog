"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[621],{3905:function(e,n,t){t.d(n,{Zo:function(){return c},kt:function(){return k}});var a=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function p(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)t=l[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)t=l[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var o=a.createContext({}),s=function(e){var n=a.useContext(o),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},c=function(e){var n=s(e.components);return a.createElement(o.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},d=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,l=e.originalType,o=e.parentName,c=p(e,["components","mdxType","originalType","parentName"]),d=s(t),k=r,m=d["".concat(o,".").concat(k)]||d[k]||u[k]||l;return t?a.createElement(m,i(i({ref:n},c),{},{components:t})):a.createElement(m,i({ref:n},c))}));function k(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var l=t.length,i=new Array(l);i[0]=d;var p={};for(var o in n)hasOwnProperty.call(n,o)&&(p[o]=n[o]);p.originalType=e,p.mdxType="string"==typeof e?e:r,i[1]=p;for(var s=2;s<l;s++)i[s]=t[s];return a.createElement.apply(null,i)}return a.createElement.apply(null,t)}d.displayName="MDXCreateElement"},6004:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return p},contentTitle:function(){return o},metadata:function(){return s},toc:function(){return c},default:function(){return d}});var a=t(7462),r=t(3366),l=(t(7294),t(3905)),i=["components"],p={sidebar_position:1,id:"babel.plugin",title:"Babel\u624b\u518c",slug:"/babel/plugin"},o="Babel \u63d2\u4ef6\u624b\u518c",s={unversionedId:"babel/babel.plugin",id:"babel/babel.plugin",title:"Babel\u624b\u518c",description:"* \u4ecb\u7ecd",source:"@site/docs/babel/plugin-handbook.md",sourceDirName:"babel",slug:"/babel/plugin",permalink:"/blog/docs/babel/plugin",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,id:"babel.plugin",title:"Babel\u624b\u518c",slug:"/babel/plugin"},sidebar:"babel",previous:{title:"Babel\u7b80\u4ecb",permalink:"/blog/docs/babel/index"}},c=[{value:'<a id="toc-asts"></a>\u62bd\u8c61\u8bed\u6cd5\u6811\uff08ASTs\uff09',id:"\u62bd\u8c61\u8bed\u6cd5\u6811asts",children:[],level:2},{value:'<a id="toc-stages-of-babel"></a>Babel \u7684\u5904\u7406\u6b65\u9aa4',id:"babel-\u7684\u5904\u7406\u6b65\u9aa4",children:[{value:'<a id="toc-parse"></a>\u89e3\u6790',id:"\u89e3\u6790",children:[{value:'<a id="toc-lexical-analysis"></a>\u8bcd\u6cd5\u5206\u6790',id:"\u8bcd\u6cd5\u5206\u6790",children:[],level:4},{value:'<a id="toc-syntactic-analysis"></a>\u8bed\u6cd5\u5206\u6790',id:"\u8bed\u6cd5\u5206\u6790",children:[],level:4}],level:3},{value:'<a id="toc-transform"></a>\u8f6c\u6362',id:"\u8f6c\u6362",children:[],level:3},{value:'<a id="toc-generate"></a>\u751f\u6210',id:"\u751f\u6210",children:[],level:3}],level:2},{value:'<a id="toc-traversal"></a>\u904d\u5386',id:"\u904d\u5386",children:[{value:'<a id="toc-visitors"></a>Visitors\uff08\u8bbf\u95ee\u8005\uff09',id:"visitors\u8bbf\u95ee\u8005",children:[],level:3},{value:'<a id="toc-paths"></a>Paths\uff08\u8def\u5f84\uff09',id:"paths\u8def\u5f84",children:[{value:'<a id="toc-paths-in-visitors"></a>Paths in Visitors\uff08\u5b58\u5728\u4e8e\u8bbf\u95ee\u8005\u4e2d\u7684\u8def\u5f84\uff09',id:"paths-in-visitors\u5b58\u5728\u4e8e\u8bbf\u95ee\u8005\u4e2d\u7684\u8def\u5f84",children:[],level:4}],level:3},{value:'<a id="toc-state"></a>State\uff08\u72b6\u6001\uff09',id:"state\u72b6\u6001",children:[],level:3},{value:'<a id="toc-scopes"></a>Scopes\uff08\u4f5c\u7528\u57df\uff09',id:"scopes\u4f5c\u7528\u57df",children:[{value:'<a id="toc-bindings"></a>Bindings\uff08\u7ed1\u5b9a\uff09',id:"bindings\u7ed1\u5b9a",children:[],level:4}],level:3}],level:2},{value:'<a id="toc-babylon"></a>babylon',id:"babylon",children:[],level:2},{value:'<a id="toc-babel-traverse"></a>babel-traverse',id:"babel-traverse",children:[],level:2},{value:'<a id="toc-babel-types"></a>babel-types',id:"babel-types",children:[{value:'<a id="toc-definitions"></a>Definitions\uff08\u5b9a\u4e49\uff09',id:"definitions\u5b9a\u4e49",children:[],level:3},{value:'<a id="toc-builders"></a>Builders\uff08\u6784\u5efa\u5668\uff09',id:"builders\u6784\u5efa\u5668",children:[],level:3},{value:'<a id="toc-validators"></a>Validators\uff08\u9a8c\u8bc1\u5668\uff09',id:"validators\u9a8c\u8bc1\u5668",children:[],level:3},{value:'<a id="toc-converters"></a>Converters\uff08\u53d8\u6362\u5668\uff09',id:"converters\u53d8\u6362\u5668",children:[],level:3}],level:2},{value:'<a id="toc-babel-generator"></a>babel-generator',id:"babel-generator",children:[],level:2},{value:'<a id="toc-babel-template"></a>babel-template',id:"babel-template",children:[],level:2},{value:'<a id="toc-visiting"></a>\u8bbf\u95ee',id:"\u8bbf\u95ee",children:[{value:'<a id="toc-get-the-path-of-a-sub-node"></a>\u83b7\u53d6\u5b50\u8282\u70b9\u7684Path',id:"\u83b7\u53d6\u5b50\u8282\u70b9\u7684path",children:[],level:3},{value:'<a id="toc-check-if-a-node-is-a-certain-type"></a>\u68c0\u67e5\u8282\u70b9\u7684\u7c7b\u578b',id:"\u68c0\u67e5\u8282\u70b9\u7684\u7c7b\u578b",children:[],level:3},{value:'<a id="toc-check-if-a-path-is-a-certain-type"></a>\u68c0\u67e5\u8def\u5f84\uff08Path\uff09\u7c7b\u578b',id:"\u68c0\u67e5\u8def\u5f84path\u7c7b\u578b",children:[],level:3},{value:'<a id="toc-check-if-an-identifier-is-referenced"></a>\u68c0\u67e5\u6807\u8bc6\u7b26\uff08Identifier\uff09\u662f\u5426\u88ab\u5f15\u7528',id:"\u68c0\u67e5\u6807\u8bc6\u7b26identifier\u662f\u5426\u88ab\u5f15\u7528",children:[],level:3},{value:'<a id="toc-find-a-specific-parent-path"></a>\u627e\u5230\u7279\u5b9a\u7684\u7236\u8def\u5f84',id:"\u627e\u5230\u7279\u5b9a\u7684\u7236\u8def\u5f84",children:[],level:3},{value:'<a id="toc-get-sibling-paths"></a>\u83b7\u53d6\u540c\u7ea7\u8def\u5f84',id:"\u83b7\u53d6\u540c\u7ea7\u8def\u5f84",children:[],level:3},{value:'<a id="toc-stopping-traversal"></a>\u505c\u6b62\u904d\u5386',id:"\u505c\u6b62\u904d\u5386",children:[],level:3}],level:2},{value:'<a id="toc-manipulation"></a>\u5904\u7406',id:"\u5904\u7406",children:[{value:'<a id="toc-replacing-a-node"></a>\u66ff\u6362\u4e00\u4e2a\u8282\u70b9',id:"\u66ff\u6362\u4e00\u4e2a\u8282\u70b9",children:[],level:3},{value:'<a id="toc-replacing-a-node-with-multiple-nodes"></a>\u7528\u591a\u8282\u70b9\u66ff\u6362\u5355\u8282\u70b9',id:"\u7528\u591a\u8282\u70b9\u66ff\u6362\u5355\u8282\u70b9",children:[],level:3},{value:'<a id="toc-removing-a-node"></a>\u5220\u9664\u4e00\u4e2a\u8282\u70b9',id:"\u5220\u9664\u4e00\u4e2a\u8282\u70b9",children:[],level:3},{value:'<a id="toc-replacing-a-parent"></a>\u66ff\u6362\u7236\u8282\u70b9',id:"\u66ff\u6362\u7236\u8282\u70b9",children:[],level:3},{value:'<a id="toc-removing-a-parent"></a>\u5220\u9664\u7236\u8282\u70b9',id:"\u5220\u9664\u7236\u8282\u70b9",children:[],level:3}],level:2},{value:'<a id="toc-scope"></a>Scope\uff08\u4f5c\u7528\u57df\uff09',id:"scope\u4f5c\u7528\u57df",children:[{value:'<a id="toc-checking-if-a-local-variable-is-bound"></a>\u68c0\u67e5\u672c\u5730\u53d8\u91cf\u662f\u5426\u88ab\u7ed1\u5b9a',id:"\u68c0\u67e5\u672c\u5730\u53d8\u91cf\u662f\u5426\u88ab\u7ed1\u5b9a",children:[],level:3},{value:'<a id="toc-generating-a-uid"></a>\u521b\u5efa\u4e00\u4e2a UID',id:"\u521b\u5efa\u4e00\u4e2a-uid",children:[],level:3},{value:'<a id="toc-pushing-a-variable-declaration-to-a-parent-scope"></a>\u63d0\u5347\u53d8\u91cf\u58f0\u660e\u81f3\u7236\u7ea7\u4f5c\u7528\u57df',id:"\u63d0\u5347\u53d8\u91cf\u58f0\u660e\u81f3\u7236\u7ea7\u4f5c\u7528\u57df",children:[],level:3},{value:'<a id="toc-rename-a-binding-and-its-references"></a>\u91cd\u547d\u540d\u7ed1\u5b9a\u53ca\u5176\u5f15\u7528',id:"\u91cd\u547d\u540d\u7ed1\u5b9a\u53ca\u5176\u5f15\u7528",children:[],level:3}],level:2},{value:'<a id="toc-pre-and-post-in-plugins"></a> \u63d2\u4ef6\u7684\u51c6\u5907\u548c\u6536\u5c3e\u5de5\u4f5c',id:"-\u63d2\u4ef6\u7684\u51c6\u5907\u548c\u6536\u5c3e\u5de5\u4f5c",children:[],level:2},{value:'<a id="toc-enabling-syntax-in-plugins"></a> \u5728\u63d2\u4ef6\u4e2d\u542f\u7528\u5176\u4ed6\u8bed\u6cd5',id:"-\u5728\u63d2\u4ef6\u4e2d\u542f\u7528\u5176\u4ed6\u8bed\u6cd5",children:[],level:2},{value:'<a id="toc-throwing-a-syntax-error"></a> \u629b\u51fa\u4e00\u4e2a\u8bed\u6cd5\u9519\u8bef',id:"-\u629b\u51fa\u4e00\u4e2a\u8bed\u6cd5\u9519\u8bef",children:[],level:2},{value:'<a id="toc-create-helper-builders-and-checkers"></a> Create Helper Builders and Checkers',id:"-create-helper-builders-and-checkers",children:[],level:2},{value:'<a id="toc-avoid-traversing-the-ast-as-much-as-possible"></a>\u5c3d\u91cf\u907f\u514d\u904d\u5386\u62bd\u8c61\u8bed\u6cd5\u6811\uff08AST\uff09',id:"\u5c3d\u91cf\u907f\u514d\u904d\u5386\u62bd\u8c61\u8bed\u6cd5\u6811ast",children:[{value:'<a id="toc-merge-visitors-whenever-possible"></a>\u53ca\u65f6\u5408\u5e76\u8bbf\u95ee\u8005\u5bf9\u8c61',id:"\u53ca\u65f6\u5408\u5e76\u8bbf\u95ee\u8005\u5bf9\u8c61",children:[],level:3},{value:'<a id="toc-do-not-traverse-when-manual-lookup-will-do"></a>\u53ef\u4ee5\u624b\u52a8\u67e5\u627e\u5c31\u4e0d\u8981\u904d\u5386',id:"\u53ef\u4ee5\u624b\u52a8\u67e5\u627e\u5c31\u4e0d\u8981\u904d\u5386",children:[],level:3}],level:2},{value:'<a id="toc-optimizing-nested-visitors"></a>\u4f18\u5316\u5d4c\u5957\u7684\u8bbf\u95ee\u8005\u5bf9\u8c61',id:"\u4f18\u5316\u5d4c\u5957\u7684\u8bbf\u95ee\u8005\u5bf9\u8c61",children:[],level:2},{value:'<a id="toc-being-aware-of-nested-structures"></a>\u7559\u610f\u5d4c\u5957\u7ed3\u6784',id:"\u7559\u610f\u5d4c\u5957\u7ed3\u6784",children:[],level:2},{value:'<a id="toc-unit-testing"></a>\u5355\u5143\u6d4b\u8bd5',id:"\u5355\u5143\u6d4b\u8bd5",children:[{value:"\u5feb\u7167\u6d4b\u8bd5",id:"\u5feb\u7167\u6d4b\u8bd5",children:[],level:3},{value:"Exec Tests",id:"exec-tests",children:[],level:3},{value:"babel-plugin-tester",id:"babel-plugin-tester",children:[],level:3}],level:2}],u={toc:c};function d(e){var n=e.components,t=(0,r.Z)(e,i);return(0,l.kt)("wrapper",(0,a.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"babel-\u63d2\u4ef6\u624b\u518c"},"Babel \u63d2\u4ef6\u624b\u518c"),(0,l.kt)("h1",{id:"\u76ee\u5f55"},"\u76ee\u5f55"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-introduction"},"\u4ecb\u7ecd")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-basics"},"\u57fa\u7840")," ",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-asts"},"\u62bd\u8c61\u8bed\u6cd5\u6811\uff08ASTs\uff09")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-stages-of-babel"},"Babel \u7684\u5904\u7406\u6b65\u9aa4")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-parse"},"\u89e3\u6790")," ",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-lexical-analysis"},"\u8bcd\u6cd5\u5206\u6790")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-syntactic-analysis"},"\u8bed\u6cd5\u5206\u6790")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-transform"},"\u8f6c\u6362")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-generate"},"\u751f\u6210")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-traversal"},"\u904d\u5386")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-visitors"},"Visitors\uff08\u8bbf\u95ee\u8005\uff09")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-paths"},"Paths\uff08\u8def\u5f84\uff09")," ",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-paths-in-visitors"},"Paths in Visitors\uff08\u5b58\u5728\u4e8e\u8bbf\u95ee\u8005\u4e2d\u7684\u8def\u5f84\uff09")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-state"},"State\uff08\u72b6\u6001\uff09")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-scopes"},"Scopes\uff08\u4f5c\u7528\u57df\uff09")," ",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-bindings"},"Bindings\uff08\u7ed1\u5b9a\uff09")))))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-api"},"API")," ",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-babylon"},"babylon")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-babel-traverse"},"babel-traverse")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-babel-types"},"babel-types")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-definitions"},"Definitions\uff08\u5b9a\u4e49\uff09")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-builders"},"Builders\uff08\u6784\u5efa\u5668\uff09")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-validators"},"Validators\uff08\u9a8c\u8bc1\u5668\uff09")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-converters"},"Converters\uff08\u53d8\u6362\u5668\uff09")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-babel-generator"},"babel-generator")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-babel-template"},"babel-template")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-writing-your-first-babel-plugin"},"\u7f16\u5199\u4f60\u7684\u7b2c\u4e00\u4e2a Babel \u63d2\u4ef6")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-transformation-operations"},"\u8f6c\u6362\u64cd\u4f5c")," ",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-visiting"},"\u8bbf\u95ee")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-get-the-path-of-a-sub-node"},"\u83b7\u53d6\u5b50\u8282\u70b9\u7684Path")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-check-if-a-node-is-a-certain-type"},"\u68c0\u67e5\u8282\u70b9\uff08Node\uff09\u7c7b\u578b")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-check-if-a-path-is-a-certain-type"},"\u68c0\u67e5\u8def\u5f84\uff08Path\uff09\u7c7b\u578b")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-check-if-an-identifier-is-referenced"},"\u68c0\u67e5\u6807\u8bc6\u7b26\uff08Identifier\uff09\u662f\u5426\u88ab\u5f15\u7528")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-find-a-specific-parent-path"},"\u627e\u5230\u7279\u5b9a\u7684\u7236\u8def\u5f84")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-get-sibling-paths"},"\u83b7\u53d6\u540c\u7ea7\u8def\u5f84")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-stopping-traversal"},"\u505c\u6b62\u904d\u5386")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-manipulation"},"\u5904\u7406")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-replacing-a-node"},"\u66ff\u6362\u4e00\u4e2a\u8282\u70b9")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-replacing-a-node-with-multiple-nodes"},"\u7528\u591a\u8282\u70b9\u66ff\u6362\u5355\u8282\u70b9")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-replacing-a-node-with-a-source-string"},"\u7528\u5b57\u7b26\u4e32\u6e90\u7801\u66ff\u6362\u8282\u70b9")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-inserting-a-sibling-node"},"\u63d2\u5165\u5144\u5f1f\u8282\u70b9")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-inserting-into-a-container"},"\u63d2\u5165\u5230\u5bb9\u5668\uff08container\uff09\u4e2d")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-removing-a-node"},"\u5220\u9664\u8282\u70b9")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-replacing-a-parent"},"\u66ff\u6362\u7236\u8282\u70b9")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-removing-a-parent"},"\u5220\u9664\u7236\u8282\u70b9")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-scope"},"Scope\uff08\u4f5c\u7528\u57df\uff09")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-checking-if-a-local-variable-is-bound"},"\u68c0\u67e5\u672c\u5730\u53d8\u91cf\u662f\u5426\u88ab\u7ed1\u5b9a")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-generating-a-uid"},"\u751f\u6210UID")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-pushing-a-variable-declaration-to-a-parent-scope"},"\u63d0\u5347\u53d8\u91cf\u58f0\u660e\u81f3\u7236\u7ea7\u4f5c\u7528\u57df")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-rename-a-binding-and-its-references"},"\u91cd\u547d\u540d\u7ed1\u5b9a\u53ca\u5176\u5f15\u7528")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-plugin-options"},"\u63d2\u4ef6\u9009\u9879")," ",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-pre-and-post-in-plugins"},"\u63d2\u4ef6\u7684\u51c6\u5907\u548c\u6536\u5c3e\u5de5\u4f5c")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-enabling-syntax-in-plugins"},"\u5728\u63d2\u4ef6\u4e2d\u542f\u7528\u5176\u4ed6\u8bed\u6cd5")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-building-nodes"},"\u6784\u5efa\u8282\u70b9")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-best-practices"},"\u6700\u4f73\u5b9e\u8df5")," ",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-avoid-traversing-the-ast-as-much-as-possible"},"\u5c3d\u91cf\u907f\u514d\u904d\u5386\u62bd\u8c61\u8bed\u6cd5\u6811\uff08AST\uff09")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-merge-visitors-whenever-possible"},"\u53ca\u65f6\u5408\u5e76\u8bbf\u95ee\u8005\u5bf9\u8c61")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-do-not-traverse-when-manual-lookup-will-do"},"\u53ef\u4ee5\u624b\u52a8\u67e5\u627e\u5c31\u4e0d\u8981\u904d\u5386")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-optimizing-nested-visitors"},"\u4f18\u5316\u5d4c\u5957\u7684\u8bbf\u95ee\u8005\u5bf9\u8c61")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-being-aware-of-nested-structures"},"\u7559\u610f\u5d4c\u5957\u7ed3\u6784")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#toc-unit-testing"},"\u5355\u5143\u6d4b\u8bd5"))))),(0,l.kt)("h1",{id:"\u4ecb\u7ecd"},(0,l.kt)("a",{id:"toc-introduction"}),"\u4ecb\u7ecd"),(0,l.kt)("p",null,"Babel \u662f\u4e00\u4e2a\u901a\u7528\u7684\u591a\u529f\u80fd\u7684 JavaScript \u7f16\u8bd1\u5668\u3002\u6b64\u5916\u5b83\u8fd8\u62e5\u6709\u4f17\u591a\u6a21\u5757\u53ef\u7528\u4e8e\u4e0d\u540c\u5f62\u5f0f\u7684\u9759\u6001\u5206\u6790\u3002"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u9759\u6001\u5206\u6790\u662f\u5728\u4e0d\u9700\u8981\u6267\u884c\u4ee3\u7801\u7684\u524d\u63d0\u4e0b\u5bf9\u4ee3\u7801\u8fdb\u884c\u5206\u6790\u7684\u5904\u7406\u8fc7\u7a0b \uff08\u6267\u884c\u4ee3\u7801\u7684\u540c\u65f6\u8fdb\u884c\u4ee3\u7801\u5206\u6790\u5373\u662f\u52a8\u6001\u5206\u6790\uff09\u3002 \u9759\u6001\u5206\u6790\u7684\u76ee\u7684\u662f\u591a\u79cd\u591a\u6837\u7684\uff0c \u5b83\u53ef\u7528\u4e8e\u8bed\u6cd5\u68c0\u67e5\uff0c\u7f16\u8bd1\uff0c\u4ee3\u7801\u9ad8\u4eae\uff0c\u4ee3\u7801\u8f6c\u6362\uff0c\u4f18\u5316\uff0c\u538b\u7f29\u7b49\u7b49\u573a\u666f\u3002")),(0,l.kt)("p",null,"\u4f60\u53ef\u4ee5\u4f7f\u7528 Babel \u521b\u5efa\u591a\u79cd\u7c7b\u578b\u7684\u5de5\u5177\u6765\u5e2e\u52a9\u4f60\u66f4\u6709\u6548\u7387\u5e76\u4e14\u5199\u51fa\u66f4\u597d\u7684\u7a0b\u5e8f\u3002"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},(0,l.kt)("strong",{parentName:"p"},(0,l.kt)("em",{parentName:"strong"},"\u5728 Twitter \u4e0a\u5173\u6ce8 ",(0,l.kt)("a",{parentName:"em",href:"https://twitter.com/thejameskyle"},"@thejameskyle"),"\uff0c\u7b2c\u4e00\u65f6\u95f4\u83b7\u53d6\u66f4\u65b0\u3002")))),(0,l.kt)("hr",null),(0,l.kt)("h1",{id:"\u57fa\u7840"},(0,l.kt)("a",{id:"toc-basics"}),"\u57fa\u7840"),(0,l.kt)("p",null,"Babel \u662f JavaScript \u7f16\u8bd1\u5668\uff0c\u66f4\u786e\u5207\u5730\u8bf4\u662f\u6e90\u7801\u5230\u6e90\u7801\u7684\u7f16\u8bd1\u5668\uff0c\u901a\u5e38\u4e5f\u53eb\u505a\u201c\u8f6c\u6362\u7f16\u8bd1\u5668\uff08transpiler\uff09\u201d\u3002 \u610f\u601d\u662f\u8bf4\u4f60\u4e3a Babel \u63d0\u4f9b\u4e00\u4e9b JavaScript \u4ee3\u7801\uff0cBabel \u66f4\u6539\u8fd9\u4e9b\u4ee3\u7801\uff0c\u7136\u540e\u8fd4\u56de\u7ed9\u4f60\u65b0\u751f\u6210\u7684\u4ee3\u7801\u3002"),(0,l.kt)("h2",{id:"\u62bd\u8c61\u8bed\u6cd5\u6811asts"},(0,l.kt)("a",{id:"toc-asts"}),"\u62bd\u8c61\u8bed\u6cd5\u6811\uff08ASTs\uff09"),(0,l.kt)("p",null,"\u8fd9\u4e2a\u5904\u7406\u8fc7\u7a0b\u4e2d\u7684\u6bcf\u4e00\u6b65\u90fd\u6d89\u53ca\u5230\u521b\u5efa\u6216\u662f\u64cd\u4f5c",(0,l.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Abstract_syntax_tree"},"\u62bd\u8c61\u8bed\u6cd5\u6811"),"\uff0c\u4ea6\u79f0 AST\u3002"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"Babel \u4f7f\u7528\u4e00\u4e2a\u57fa\u4e8e ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/estree/estree"},"ESTree")," \u5e76\u4fee\u6539\u8fc7\u7684 AST\uff0c\u5b83\u7684\u5185\u6838\u8bf4\u660e\u6587\u6863\u53ef\u4ee5\u5728","[\u8fd9\u91cc]","(",(0,l.kt)("a",{parentName:"p",href:"https://github."},"https://github.")," com/babel/babel/blob/master/doc/ast/spec. md)\u627e\u5230\u3002.")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"function square(n) {\n  return n * n;\n}\n")),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},(0,l.kt)("a",{parentName:"p",href:"http://astexplorer.net/"},"AST Explorer")," \u53ef\u4ee5\u8ba9\u4f60\u5bf9 AST \u8282\u70b9\u6709\u4e00\u4e2a\u66f4\u597d\u7684\u611f\u6027\u8ba4\u8bc6\u3002 ",(0,l.kt)("a",{parentName:"p",href:"http://astexplorer.net/#/Z1exs6BWMq"},"\u8fd9\u91cc"),"\u662f\u4e0a\u8ff0\u4ee3\u7801\u7684\u4e00\u4e2a\u793a\u4f8b\u94fe\u63a5\u3002")),(0,l.kt)("p",null,"\u8fd9\u4e2a\u7a0b\u5e8f\u53ef\u4ee5\u88ab\u8868\u793a\u6210\u5982\u4e0b\u7684\u4e00\u68f5\u6811\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-md"},"- FunctionDeclaration:\n  - id:\n    - Identifier:\n      - name: square\n  - params [1]\n    - Identifier\n      - name: n\n  - body:\n    - BlockStatement\n      - body [1]\n        - ReturnStatement\n          - argument\n            - BinaryExpression\n              - operator: *\n              - left\n                - Identifier\n                  - name: n\n              - right\n                - Identifier\n                  - name: n\n")),(0,l.kt)("p",null,"\u6216\u662f\u5982\u4e0b\u6240\u793a\u7684 JavaScript Object\uff08\u5bf9\u8c61\uff09\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'{\n  type: "FunctionDeclaration",\n  id: {\n    type: "Identifier",\n    name: "square"\n  },\n  params: [{\n    type: "Identifier",\n    name: "n"\n  }],\n  body: {\n    type: "BlockStatement",\n    body: [{\n      type: "ReturnStatement",\n      argument: {\n        type: "BinaryExpression",\n        operator: "*",\n        left: {\n          type: "Identifier",\n          name: "n"\n        },\n        right: {\n          type: "Identifier",\n          name: "n"\n        }\n      }\n    }]\n  }\n}\n')),(0,l.kt)("p",null,"\u4f60\u4f1a\u7559\u610f\u5230 AST \u7684\u6bcf\u4e00\u5c42\u90fd\u62e5\u6709\u76f8\u540c\u7684\u7ed3\u6784\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'{\n  type: "FunctionDeclaration",\n  id: {...},\n  params: [...],\n  body: {...}\n}\n')),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'{\n  type: "Identifier",\n  name: ...\n}\n')),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'{\n  type: "BinaryExpression",\n  operator: ...,\n  left: {...},\n  right: {...}\n}\n')),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u6ce8\u610f\uff1a\u51fa\u4e8e\u7b80\u5316\u7684\u76ee\u7684\u79fb\u9664\u4e86\u67d0\u4e9b\u5c5e\u6027")),(0,l.kt)("p",null,"\u8fd9\u6837\u7684\u6bcf\u4e00\u5c42\u7ed3\u6784\u4e5f\u88ab\u53eb\u505a ",(0,l.kt)("strong",{parentName:"p"},"\u8282\u70b9\uff08Node\uff09"),"\u3002 \u4e00\u4e2a AST \u53ef\u4ee5\u7531\u5355\u4e00\u7684\u8282\u70b9\u6216\u662f\u6210\u767e\u4e0a\u5343\u4e2a\u8282\u70b9\u6784\u6210\u3002 \u5b83\u4eec\u7ec4\u5408\u5728\u4e00\u8d77\u53ef\u4ee5\u63cf\u8ff0\u7528\u4e8e\u9759\u6001\u5206\u6790\u7684\u7a0b\u5e8f\u8bed\u6cd5\u3002"),(0,l.kt)("p",null,"\u6bcf\u4e00\u4e2a\u8282\u70b9\u90fd\u6709\u5982\u4e0b\u6240\u793a\u7684\u63a5\u53e3\uff08Interface\uff09\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-typescript"},"interface Node {\n  type: string;\n}\n")),(0,l.kt)("p",null,"\u5b57\u7b26\u4e32\u5f62\u5f0f\u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"type")," \u5b57\u6bb5\u8868\u793a\u8282\u70b9\u7684\u7c7b\u578b\uff08\u5982\uff1a ",(0,l.kt)("inlineCode",{parentName:"p"},'"FunctionDeclaration"'),"\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},'"Identifier"'),"\uff0c\u6216 ",(0,l.kt)("inlineCode",{parentName:"p"},'"BinaryExpression"'),"\uff09\u3002 \u6bcf\u4e00\u79cd\u7c7b\u578b\u7684\u8282\u70b9\u5b9a\u4e49\u4e86\u4e00\u4e9b\u9644\u52a0\u5c5e\u6027\u7528\u6765\u8fdb\u4e00\u6b65\u63cf\u8ff0\u8be5\u8282\u70b9\u7c7b\u578b\u3002"),(0,l.kt)("p",null,"Babel \u8fd8\u4e3a\u6bcf\u4e2a\u8282\u70b9\u989d\u5916\u751f\u6210\u4e86\u4e00\u4e9b\u5c5e\u6027\uff0c\u7528\u4e8e\u63cf\u8ff0\u8be5\u8282\u70b9\u5728\u539f\u59cb\u4ee3\u7801\u4e2d\u7684\u4f4d\u7f6e\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"{\n  type: ...,\n  start: 0,\n  end: 38,\n  loc: {\n    start: {\n      line: 1,\n      column: 0\n    },\n    end: {\n      line: 3,\n      column: 1\n    }\n  },\n  ...\n}\n")),(0,l.kt)("p",null,"\u6bcf\u4e00\u4e2a\u8282\u70b9\u90fd\u4f1a\u6709 ",(0,l.kt)("inlineCode",{parentName:"p"},"start"),"\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},"end"),"\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},"loc")," \u8fd9\u51e0\u4e2a\u5c5e\u6027\u3002"),(0,l.kt)("h2",{id:"babel-\u7684\u5904\u7406\u6b65\u9aa4"},(0,l.kt)("a",{id:"toc-stages-of-babel"}),"Babel \u7684\u5904\u7406\u6b65\u9aa4"),(0,l.kt)("p",null,"Babel \u7684\u4e09\u4e2a\u4e3b\u8981\u5904\u7406\u6b65\u9aa4\u5206\u522b\u662f\uff1a ",(0,l.kt)("strong",{parentName:"p"},"\u89e3\u6790\uff08parse\uff09"),"\uff0c",(0,l.kt)("strong",{parentName:"p"},"\u8f6c\u6362\uff08transform\uff09"),"\uff0c",(0,l.kt)("strong",{parentName:"p"},"\u751f\u6210\uff08generate\uff09"),"\u3002."),(0,l.kt)("h3",{id:"\u89e3\u6790"},(0,l.kt)("a",{id:"toc-parse"}),"\u89e3\u6790"),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"\u89e3\u6790"),"\u6b65\u9aa4\u63a5\u6536\u4ee3\u7801\u5e76\u8f93\u51fa AST\u3002 \u8fd9\u4e2a\u6b65\u9aa4\u5206\u4e3a\u4e24\u4e2a\u9636\u6bb5\uff1a",(0,l.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Lexical_analysis"},(0,l.kt)("strong",{parentName:"a"},"\u8bcd\u6cd5\u5206\u6790\uff08Lexical Analysis\uff09 ")),"\u548c ",(0,l.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Parsing"},(0,l.kt)("strong",{parentName:"a"},"\u8bed\u6cd5\u5206\u6790\uff08Syntactic Analysis\uff09")),"\u3002."),(0,l.kt)("h4",{id:"\u8bcd\u6cd5\u5206\u6790"},(0,l.kt)("a",{id:"toc-lexical-analysis"}),"\u8bcd\u6cd5\u5206\u6790"),(0,l.kt)("p",null,"\u8bcd\u6cd5\u5206\u6790\u9636\u6bb5\u628a\u5b57\u7b26\u4e32\u5f62\u5f0f\u7684\u4ee3\u7801\u8f6c\u6362\u4e3a ",(0,l.kt)("strong",{parentName:"p"},"\u4ee4\u724c\uff08tokens\uff09")," \u6d41\u3002."),(0,l.kt)("p",null,"\u4f60\u53ef\u4ee5\u628a\u4ee4\u724c\u770b\u4f5c\u662f\u4e00\u4e2a\u6241\u5e73\u7684\u8bed\u6cd5\u7247\u6bb5\u6570\u7ec4\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"n * n;\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'[\n  { type: { ... }, value: "n", start: 0, end: 1, loc: { ... } },\n  { type: { ... }, value: "*", start: 2, end: 3, loc: { ... } },\n  { type: { ... }, value: "n", start: 4, end: 5, loc: { ... } },\n  ...\n]\n')),(0,l.kt)("p",null,"\u6bcf\u4e00\u4e2a ",(0,l.kt)("inlineCode",{parentName:"p"},"type")," \u6709\u4e00\u7ec4\u5c5e\u6027\u6765\u63cf\u8ff0\u8be5\u4ee4\u724c\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"{\n  type: {\n    label: 'name',\n    keyword: undefined,\n    beforeExpr: false,\n    startsExpr: true,\n    rightAssociative: false,\n    isLoop: false,\n    isAssign: false,\n    prefix: false,\n    postfix: false,\n    binop: null,\n    updateContext: null\n  },\n  ...\n}\n")),(0,l.kt)("p",null,"\u548c AST \u8282\u70b9\u4e00\u6837\u5b83\u4eec\u4e5f\u6709 ",(0,l.kt)("inlineCode",{parentName:"p"},"start"),"\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},"end"),"\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},"loc")," \u5c5e\u6027\u3002."),(0,l.kt)("h4",{id:"\u8bed\u6cd5\u5206\u6790"},(0,l.kt)("a",{id:"toc-syntactic-analysis"}),"\u8bed\u6cd5\u5206\u6790"),(0,l.kt)("p",null,"\u8bed\u6cd5\u5206\u6790\u9636\u6bb5\u4f1a\u628a\u4e00\u4e2a\u4ee4\u724c\u6d41\u8f6c\u6362\u6210 AST \u7684\u5f62\u5f0f\u3002 \u8fd9\u4e2a\u9636\u6bb5\u4f1a\u4f7f\u7528\u4ee4\u724c\u4e2d\u7684\u4fe1\u606f\u628a\u5b83\u4eec\u8f6c\u6362\u6210\u4e00\u4e2a AST \u7684\u8868\u8ff0\u7ed3\u6784\uff0c\u8fd9\u6837\u66f4\u6613\u4e8e\u540e\u7eed\u7684\u64cd\u4f5c\u3002"),(0,l.kt)("h3",{id:"\u8f6c\u6362"},(0,l.kt)("a",{id:"toc-transform"}),"\u8f6c\u6362"),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Program_transformation"},"\u8f6c\u6362"),"\u6b65\u9aa4\u63a5\u6536 AST \u5e76\u5bf9\u5176\u8fdb\u884c\u904d\u5386\uff0c\u5728\u6b64\u8fc7\u7a0b\u4e2d\u5bf9\u8282\u70b9\u8fdb\u884c\u6dfb\u52a0\u3001\u66f4\u65b0\u53ca\u79fb\u9664\u7b49\u64cd\u4f5c\u3002 \u8fd9\u662f Babel \u6216\u662f\u5176\u4ed6\u7f16\u8bd1\u5668\u4e2d\u6700\u590d\u6742\u7684\u8fc7\u7a0b \u540c\u65f6\u4e5f\u662f\u63d2\u4ef6\u5c06\u8981\u4ecb\u5165\u5de5\u4f5c\u7684\u90e8\u5206\uff0c\u8fd9\u5c06\u662f\u672c\u624b\u518c\u7684\u4e3b\u8981\u5185\u5bb9\uff0c \u56e0\u6b64\u8ba9\u6211\u4eec\u6162\u6162\u6765\u3002"),(0,l.kt)("h3",{id:"\u751f\u6210"},(0,l.kt)("a",{id:"toc-generate"}),"\u751f\u6210"),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Code_generation_(compiler)"},"\u4ee3\u7801\u751f\u6210"),"\u6b65\u9aa4\u628a\u6700\u7ec8\uff08\u7ecf\u8fc7\u4e00\u7cfb\u5217\u8f6c\u6362\u4e4b\u540e\uff09\u7684 AST \u8f6c\u6362\u6210\u5b57\u7b26\u4e32\u5f62\u5f0f\u7684\u4ee3\u7801\uff0c\u540c\u65f6\u8fd8\u4f1a\u521b\u5efa",(0,l.kt)("a",{parentName:"p",href:"http://www.html5rocks.com/en/tutorials/developertools/sourcemaps/"},"\u6e90\u7801\u6620\u5c04\uff08source maps\uff09"),"\u3002."),(0,l.kt)("p",null,"\u4ee3\u7801\u751f\u6210\u5176\u5b9e\u5f88\u7b80\u5355\uff1a\u6df1\u5ea6\u4f18\u5148\u904d\u5386\u6574\u4e2a AST\uff0c\u7136\u540e\u6784\u5efa\u53ef\u4ee5\u8868\u793a\u8f6c\u6362\u540e\u4ee3\u7801\u7684\u5b57\u7b26\u4e32\u3002"),(0,l.kt)("h2",{id:"\u904d\u5386"},(0,l.kt)("a",{id:"toc-traversal"}),"\u904d\u5386"),(0,l.kt)("p",null,"\u60f3\u8981\u8f6c\u6362 AST \u4f60\u9700\u8981\u8fdb\u884c\u9012\u5f52\u7684",(0,l.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Tree_traversal"},"\u6811\u5f62\u904d\u5386"),"\u3002"),(0,l.kt)("p",null,"\u6bd4\u65b9\u8bf4\u6211\u4eec\u6709\u4e00\u4e2a ",(0,l.kt)("inlineCode",{parentName:"p"},"FunctionDeclaration")," \u7c7b\u578b\u3002\u5b83\u6709\u51e0\u4e2a\u5c5e\u6027\uff1a",(0,l.kt)("inlineCode",{parentName:"p"},"id"),"\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},"params"),"\uff0c\u548c ",(0,l.kt)("inlineCode",{parentName:"p"},"body"),"\uff0c\u6bcf\u4e00\u4e2a\u90fd\u6709\u4e00\u4e9b\u5185\u5d4c\u8282\u70b9\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'{\n  type: "FunctionDeclaration",\n  id: {\n    type: "Identifier",\n    name: "square"\n  },\n  params: [{\n    type: "Identifier",\n    name: "n"\n  }],\n  body: {\n    type: "BlockStatement",\n    body: [{\n      type: "ReturnStatement",\n      argument: {\n        type: "BinaryExpression",\n        operator: "*",\n        left: {\n          type: "Identifier",\n          name: "n"\n        },\n        right: {\n          type: "Identifier",\n          name: "n"\n        }\n      }\n    }]\n  }\n}\n')),(0,l.kt)("p",null,"\u4e8e\u662f\u6211\u4eec\u4ece ",(0,l.kt)("inlineCode",{parentName:"p"},"FunctionDeclaration")," \u5f00\u59cb\u5e76\u4e14\u6211\u4eec\u77e5\u9053\u5b83\u7684\u5185\u90e8\u5c5e\u6027\uff08\u5373\uff1a",(0,l.kt)("inlineCode",{parentName:"p"},"id"),"\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},"params"),"\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},"body"),"\uff09\uff0c\u6240\u4ee5\u6211\u4eec\u4f9d\u6b21\u8bbf\u95ee\u6bcf\u4e00\u4e2a\u5c5e\u6027\u53ca\u5b83\u4eec\u7684\u5b50\u8282\u70b9\u3002"),(0,l.kt)("p",null,"\u63a5\u7740\u6211\u4eec\u6765\u5230 ",(0,l.kt)("inlineCode",{parentName:"p"},"id"),"\uff0c\u5b83\u662f\u4e00\u4e2a ",(0,l.kt)("inlineCode",{parentName:"p"},"Identifier"),"\u3002",(0,l.kt)("inlineCode",{parentName:"p"},"Identifier")," \u6ca1\u6709\u4efb\u4f55\u5b50\u8282\u70b9\u5c5e\u6027\uff0c\u6240\u4ee5\u6211\u4eec\u7ee7\u7eed\u3002"),(0,l.kt)("p",null,"\u4e4b\u540e\u662f ",(0,l.kt)("inlineCode",{parentName:"p"},"params"),"\uff0c\u7531\u4e8e\u5b83\u662f\u4e00\u4e2a\u6570\u7ec4\u8282\u70b9\u6240\u4ee5\u6211\u4eec\u8bbf\u95ee\u5176\u4e2d\u7684\u6bcf\u4e00\u4e2a\uff0c\u5b83\u4eec\u90fd\u662f ",(0,l.kt)("inlineCode",{parentName:"p"},"Identifier")," \u7c7b\u578b\u7684\u5355\u4e00\u8282\u70b9\uff0c\u7136\u540e\u6211\u4eec\u7ee7\u7eed\u3002"),(0,l.kt)("p",null,"\u6b64\u65f6\u6211\u4eec\u6765\u5230\u4e86 ",(0,l.kt)("inlineCode",{parentName:"p"},"body"),"\uff0c\u8fd9\u662f\u4e00\u4e2a ",(0,l.kt)("inlineCode",{parentName:"p"},"BlockStatement")," \u5e76\u4e14\u4e5f\u6709\u4e00\u4e2a ",(0,l.kt)("inlineCode",{parentName:"p"},"body"),"\u8282\u70b9\uff0c\u800c\u4e14\u4e5f\u662f\u4e00\u4e2a\u6570\u7ec4\u8282\u70b9\uff0c\u6211\u4eec\u7ee7\u7eed\u8bbf\u95ee\u5176\u4e2d\u7684\u6bcf\u4e00\u4e2a\u3002"),(0,l.kt)("p",null,"\u8fd9\u91cc\u552f\u4e00\u7684\u4e00\u4e2a\u5c5e\u6027\u662f ",(0,l.kt)("inlineCode",{parentName:"p"},"ReturnStatement")," \u8282\u70b9\uff0c\u5b83\u6709\u4e00\u4e2a ",(0,l.kt)("inlineCode",{parentName:"p"},"argument"),"\uff0c\u6211\u4eec\u8bbf\u95ee ",(0,l.kt)("inlineCode",{parentName:"p"},"argument")," \u5c31\u627e\u5230\u4e86 ",(0,l.kt)("inlineCode",{parentName:"p"},"BinaryExpression"),"\u3002."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"BinaryExpression")," \u6709\u4e00\u4e2a ",(0,l.kt)("inlineCode",{parentName:"p"},"operator"),"\uff0c\u4e00\u4e2a ",(0,l.kt)("inlineCode",{parentName:"p"},"left"),"\uff0c\u548c\u4e00\u4e2a ",(0,l.kt)("inlineCode",{parentName:"p"},"right"),"\u3002 Operator \u4e0d\u662f\u4e00\u4e2a\u8282\u70b9\uff0c\u5b83\u53ea\u662f\u4e00\u4e2a\u503c\u56e0\u6b64\u6211\u4eec\u4e0d\u7528\u7ee7\u7eed\u5411\u5185\u904d\u5386\uff0c\u6211\u4eec\u53ea\u9700\u8981\u8bbf\u95ee ",(0,l.kt)("inlineCode",{parentName:"p"},"left")," \u548c ",(0,l.kt)("inlineCode",{parentName:"p"},"right"),"\u3002."),(0,l.kt)("p",null,"Babel \u7684\u8f6c\u6362\u6b65\u9aa4\u5168\u90fd\u662f\u8fd9\u6837\u7684\u904d\u5386\u8fc7\u7a0b\u3002"),(0,l.kt)("h3",{id:"visitors\u8bbf\u95ee\u8005"},(0,l.kt)("a",{id:"toc-visitors"}),"Visitors\uff08\u8bbf\u95ee\u8005\uff09"),(0,l.kt)("p",null,"\u5f53\u6211\u4eec\u8c08\u53ca\u201c\u8fdb\u5165\u201d\u4e00\u4e2a\u8282\u70b9\uff0c\u5b9e\u9645\u4e0a\u662f\u8bf4\u6211\u4eec\u5728",(0,l.kt)("strong",{parentName:"p"},"\u8bbf\u95ee"),"\u5b83\u4eec\uff0c \u4e4b\u6240\u4ee5\u4f7f\u7528\u8fd9\u6837\u7684\u672f\u8bed\u662f\u56e0\u4e3a\u6709\u4e00\u4e2a",(0,l.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Visitor_pattern"},(0,l.kt)("strong",{parentName:"a"},"\u8bbf\u95ee\u8005\u6a21\u5f0f\uff08visitor\uff09")),"\u7684\u6982\u5ff5\u3002."),(0,l.kt)("p",null,"\u8bbf\u95ee\u8005\u662f\u4e00\u4e2a\u7528\u4e8e AST \u904d\u5386\u7684\u8de8\u8bed\u8a00\u7684\u6a21\u5f0f\u3002 \u7b80\u5355\u7684\u8bf4\u5b83\u4eec\u5c31\u662f\u4e00\u4e2a\u5bf9\u8c61\uff0c\u5b9a\u4e49\u4e86\u7528\u4e8e\u5728\u4e00\u4e2a\u6811\u72b6\u7ed3\u6784\u4e2d\u83b7\u53d6\u5177\u4f53\u8282\u70b9\u7684\u65b9\u6cd5\u3002 \u8fd9\u4e48\u8bf4\u6709\u4e9b\u62bd\u8c61\u6240\u4ee5\u8ba9\u6211\u4eec\u6765\u770b\u4e00\u4e2a\u4f8b\u5b50\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'const MyVisitor = {\n  Identifier() {\n    console.log("Called!");\n  }\n};\n\n// \u4f60\u4e5f\u53ef\u4ee5\u5148\u521b\u5efa\u4e00\u4e2a\u8bbf\u95ee\u8005\u5bf9\u8c61\uff0c\u5e76\u5728\u7a0d\u540e\u7ed9\u5b83\u6dfb\u52a0\u65b9\u6cd5\u3002\nlet visitor = {};\nvisitor.MemberExpression = function() {};\nvisitor.FunctionDeclaration = function() {}\n')),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},(0,l.kt)("strong",{parentName:"p"},"\u6ce8\u610f"),"\uff1a ",(0,l.kt)("inlineCode",{parentName:"p"},"Identifier() { ... }")," \u662f ",(0,l.kt)("inlineCode",{parentName:"p"},"Identifier: { enter() { ... } }")," \u7684\u7b80\u5199\u5f62\u5f0f\u3002.")),(0,l.kt)("p",null,"\u8fd9\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u8bbf\u95ee\u8005\uff0c\u628a\u5b83\u7528\u4e8e\u904d\u5386\u4e2d\u65f6\uff0c\u6bcf\u5f53\u5728\u6811\u4e2d\u9047\u89c1\u4e00\u4e2a ",(0,l.kt)("inlineCode",{parentName:"p"},"Identifier")," \u7684\u65f6\u5019\u4f1a\u8c03\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"Identifier()")," \u65b9\u6cd5\u3002"),(0,l.kt)("p",null,"\u6240\u4ee5\u5728\u4e0b\u9762\u7684\u4ee3\u7801\u4e2d ",(0,l.kt)("inlineCode",{parentName:"p"},"Identifier()")," \u65b9\u6cd5\u4f1a\u88ab\u8c03\u7528\u56db\u6b21\uff08\u5305\u62ec ",(0,l.kt)("inlineCode",{parentName:"p"},"square")," \u5728\u5185\uff0c\u603b\u5171\u6709\u56db\u4e2a ",(0,l.kt)("inlineCode",{parentName:"p"},"Identifier"),"\uff09\u3002)."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"function square(n) {\n  return n * n;\n}\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"path.traverse(MyVisitor);\nCalled!\nCalled!\nCalled!\nCalled!\n")),(0,l.kt)("p",null,"\u8fd9\u4e9b\u8c03\u7528\u90fd\u53d1\u751f\u5728",(0,l.kt)("strong",{parentName:"p"},"\u8fdb\u5165"),"\u8282\u70b9\u65f6\uff0c\u4e0d\u8fc7\u6709\u65f6\u5019\u6211\u4eec\u4e5f\u53ef\u4ee5\u5728",(0,l.kt)("strong",{parentName:"p"},"\u9000\u51fa"),"\u65f6\u8c03\u7528\u8bbf\u95ee\u8005\u65b9\u6cd5\u3002."),(0,l.kt)("p",null,"\u5047\u8bbe\u6211\u4eec\u6709\u4e00\u4e2a\u6811\u72b6\u7ed3\u6784\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"- FunctionDeclaration\n  - Identifier (id)\n  - Identifier (params[0])\n  - BlockStatement (body)\n    - ReturnStatement (body)\n      - BinaryExpression (argument)\n        - Identifier (left)\n        - Identifier (right)\n")),(0,l.kt)("p",null,"\u5f53\u6211\u4eec\u5411\u4e0b\u904d\u5386\u8fd9\u9897\u6811\u7684\u6bcf\u4e00\u4e2a\u5206\u652f\u65f6\u6211\u4eec\u6700\u7ec8\u4f1a\u8d70\u5230\u5c3d\u5934\uff0c\u4e8e\u662f\u6211\u4eec\u9700\u8981\u5f80\u4e0a\u904d\u5386\u56de\u53bb\u4ece\u800c\u83b7\u53d6\u5230\u4e0b\u4e00\u4e2a\u8282\u70b9\u3002 \u5411\u4e0b\u904d\u5386\u8fd9\u68f5\u6811\u6211\u4eec",(0,l.kt)("strong",{parentName:"p"},"\u8fdb\u5165"),"\u6bcf\u4e2a\u8282\u70b9\uff0c\u5411\u4e0a\u904d\u5386\u56de\u53bb\u65f6\u6211\u4eec",(0,l.kt)("strong",{parentName:"p"},"\u9000\u51fa"),"\u6bcf\u4e2a\u8282\u70b9\u3002"),(0,l.kt)("p",null,"\u8ba9\u6211\u4eec\u4ee5\u4e0a\u9762\u90a3\u68f5\u6811\u4e3a\u4f8b\u5b50\u8d70\u4e00\u904d\u8fd9\u4e2a\u8fc7\u7a0b\u3002"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u8fdb\u5165 ",(0,l.kt)("inlineCode",{parentName:"li"},"FunctionDeclaration")," ",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u8fdb\u5165 ",(0,l.kt)("inlineCode",{parentName:"li"},"Identifier (id)")),(0,l.kt)("li",{parentName:"ul"},"\u8d70\u5230\u5c3d\u5934"),(0,l.kt)("li",{parentName:"ul"},"\u9000\u51fa ",(0,l.kt)("inlineCode",{parentName:"li"},"Identifier (id)")),(0,l.kt)("li",{parentName:"ul"},"\u8fdb\u5165 ",(0,l.kt)("inlineCode",{parentName:"li"},"Identifier (params[0])")),(0,l.kt)("li",{parentName:"ul"},"\u8d70\u5230\u5c3d\u5934"),(0,l.kt)("li",{parentName:"ul"},"\u9000\u51fa ",(0,l.kt)("inlineCode",{parentName:"li"},"Identifier (params[0])")),(0,l.kt)("li",{parentName:"ul"},"\u8fdb\u5165 ",(0,l.kt)("inlineCode",{parentName:"li"},"BlockStatement (body)")),(0,l.kt)("li",{parentName:"ul"},"\u8fdb\u5165 ",(0,l.kt)("inlineCode",{parentName:"li"},"ReturnStatement (body)")," ",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u8fdb\u5165 ",(0,l.kt)("inlineCode",{parentName:"li"},"BinaryExpression (argument)")),(0,l.kt)("li",{parentName:"ul"},"\u8fdb\u5165 ",(0,l.kt)("inlineCode",{parentName:"li"},"Identifier (left)")," ",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u8d70\u5230\u5c3d\u5934"))),(0,l.kt)("li",{parentName:"ul"},"\u9000\u51fa ",(0,l.kt)("inlineCode",{parentName:"li"},"Identifier (left)")),(0,l.kt)("li",{parentName:"ul"},"\u8fdb\u5165 ",(0,l.kt)("inlineCode",{parentName:"li"},"Identifier (right)")," ",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"\u8d70\u5230\u5c3d\u5934"))),(0,l.kt)("li",{parentName:"ul"},"\u9000\u51fa ",(0,l.kt)("inlineCode",{parentName:"li"},"Identifier (right)")),(0,l.kt)("li",{parentName:"ul"},"\u9000\u51fa ",(0,l.kt)("inlineCode",{parentName:"li"},"BinaryExpression (argument)")))),(0,l.kt)("li",{parentName:"ul"},"\u9000\u51fa ",(0,l.kt)("inlineCode",{parentName:"li"},"ReturnStatement (body)")),(0,l.kt)("li",{parentName:"ul"},"\u9000\u51fa ",(0,l.kt)("inlineCode",{parentName:"li"},"BlockStatement (body)")))),(0,l.kt)("li",{parentName:"ul"},"\u9000\u51fa ",(0,l.kt)("inlineCode",{parentName:"li"},"FunctionDeclaration"))),(0,l.kt)("p",null,"\u6240\u4ee5\u5f53\u521b\u5efa\u8bbf\u95ee\u8005\u65f6\u4f60\u5b9e\u9645\u4e0a\u6709\u4e24\u6b21\u673a\u4f1a\u6765\u8bbf\u95ee\u4e00\u4e2a\u8282\u70b9\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'const MyVisitor = {\n  Identifier: {\n    enter() {\n      console.log("Entered!");\n    },\n    exit() {\n      console.log("Exited!");\n    }\n  }\n};\n')),(0,l.kt)("p",null,"\u5982\u6709\u5fc5\u8981\uff0c\u4f60\u8fd8\u53ef\u4ee5\u628a\u65b9\u6cd5\u540d\u7528",(0,l.kt)("inlineCode",{parentName:"p"},"|"),"\u5206\u5272\u6210",(0,l.kt)("inlineCode",{parentName:"p"},"Idenfifier |MemberExpression"),"\u5f62\u5f0f\u7684\u5b57\u7b26\u4e32\uff0c\u628a\u540c\u4e00\u4e2a\u51fd\u6570\u5e94\u7528\u5230\u591a\u79cd\u8bbf\u95ee\u8282\u70b9\u3002."),(0,l.kt)("p",null,"\u5728",(0,l.kt)("a",{parentName:"p",href:"https://github.com/babel/babel/blob/2b6ff53459d97218b0cf16f8a51c14a165db1fd2/packages/babel-plugin-transform-flow-comments/src/index.js#L47"},"flow-comments")," \u63d2\u4ef6\u4e2d\u7684\u4f8b\u5b50\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'const MyVisitor = {\n  "ExportNamedDeclaration|Flow"(path) {}\n};\n')),(0,l.kt)("p",null,"\u4f60\u4e5f\u53ef\u4ee5\u5728\u8bbf\u95ee\u8005\u4e2d\u4f7f\u7528\u522b\u540d(\u5982",(0,l.kt)("a",{parentName:"p",href:"https://github.com/babel/babel/tree/master/packages/babel-types/src/definitions"},"babel-types"),"\u5b9a\u4e49)."),(0,l.kt)("p",null,"\u4f8b\u5982\uff0c"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"Function")," is an alias for ",(0,l.kt)("inlineCode",{parentName:"p"},"FunctionDeclaration"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"FunctionExpression"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"ArrowFunctionExpression"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"ObjectMethod")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"ClassMethod"),"."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"const MyVisitor = {\n  Function(path) {}\n};\n")),(0,l.kt)("h3",{id:"paths\u8def\u5f84"},(0,l.kt)("a",{id:"toc-paths"}),"Paths\uff08\u8def\u5f84\uff09"),(0,l.kt)("p",null,"AST \u901a\u5e38\u4f1a\u6709\u8bb8\u591a\u8282\u70b9\uff0c\u90a3\u4e48\u8282\u70b9\u76f4\u63a5\u5982\u4f55\u76f8\u4e92\u5173\u8054\u5462\uff1f \u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u4e00\u4e2a\u53ef\u64cd\u4f5c\u548c\u8bbf\u95ee\u7684\u5de8\u5927\u53ef\u53d8\u5bf9\u8c61\u8868\u793a\u8282\u70b9\u4e4b\u95f4\u7684\u5173\u8054\u5173\u7cfb\uff0c\u6216\u8005\u4e5f\u53ef\u4ee5\u7528",(0,l.kt)("strong",{parentName:"p"},"Paths"),"\uff08\u8def\u5f84\uff09\u6765\u7b80\u5316\u8fd9\u4ef6\u4e8b\u60c5\u3002."),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Path")," \u662f\u8868\u793a\u4e24\u4e2a\u8282\u70b9\u4e4b\u95f4\u8fde\u63a5\u7684\u5bf9\u8c61\u3002"),(0,l.kt)("p",null,"\u4f8b\u5982\uff0c\u5982\u679c\u6709\u4e0b\u9762\u8fd9\u6837\u4e00\u4e2a\u8282\u70b9\u53ca\u5176\u5b50\u8282\u70b9\ufe30"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'{\n  type: "FunctionDeclaration",\n  id: {\n    type: "Identifier",\n    name: "square"\n  },\n  ...\n}\n')),(0,l.kt)("p",null,"\u5c06\u5b50\u8282\u70b9 ",(0,l.kt)("inlineCode",{parentName:"p"},"Identifier")," \u8868\u793a\u4e3a\u4e00\u4e2a\u8def\u5f84\uff08Path\uff09\u7684\u8bdd\uff0c\u770b\u8d77\u6765\u662f\u8fd9\u6837\u7684\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'{\n  "parent": {\n    "type": "FunctionDeclaration",\n    "id": {...},\n    ....\n  },\n  "node": {\n    "type": "Identifier",\n    "name": "square"\n  }\n}\n')),(0,l.kt)("p",null,"\u540c\u65f6\u5b83\u8fd8\u5305\u542b\u5173\u4e8e\u8be5\u8def\u5f84\u7684\u5176\u4ed6\u5143\u6570\u636e\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'{\n  "parent": {...},\n  "node": {...},\n  "hub": {...},\n  "contexts": [],\n  "data": {},\n  "shouldSkip": false,\n  "shouldStop": false,\n  "removed": false,\n  "state": null,\n  "opts": null,\n  "skipKeys": null,\n  "parentPath": null,\n  "context": null,\n  "container": null,\n  "listKey": null,\n  "inList": false,\n  "parentKey": null,\n  "key": null,\n  "scope": null,\n  "type": null,\n  "typeAnnotation": null\n}\n')),(0,l.kt)("p",null,"\u5f53\u7136\u8def\u5f84\u5bf9\u8c61\u8fd8\u5305\u542b\u6dfb\u52a0\u3001\u66f4\u65b0\u3001\u79fb\u52a8\u548c\u5220\u9664\u8282\u70b9\u6709\u5173\u7684\u5176\u4ed6\u5f88\u591a\u65b9\u6cd5\uff0c\u7a0d\u540e\u6211\u4eec\u518d\u6765\u770b\u8fd9\u4e9b\u65b9\u6cd5\u3002"),(0,l.kt)("p",null,"\u5728\u67d0\u79cd\u610f\u4e49\u4e0a\uff0c\u8def\u5f84\u662f\u4e00\u4e2a\u8282\u70b9\u5728\u6811\u4e2d\u7684\u4f4d\u7f6e\u4ee5\u53ca\u5173\u4e8e\u8be5\u8282\u70b9\u5404\u79cd\u4fe1\u606f\u7684\u54cd\u5e94\u5f0f ",(0,l.kt)("strong",{parentName:"p"},"Reactive")," \u8868\u793a\u3002 \u5f53\u4f60\u8c03\u7528\u4e00\u4e2a\u4fee\u6539\u6811\u7684\u65b9\u6cd5\u540e\uff0c\u8def\u5f84\u4fe1\u606f\u4e5f\u4f1a\u88ab\u66f4\u65b0\u3002 Babel \u5e2e\u4f60\u7ba1\u7406\u8fd9\u4e00\u5207\uff0c\u4ece\u800c\u4f7f\u5f97\u8282\u70b9\u64cd\u4f5c\u7b80\u5355\uff0c\u5c3d\u53ef\u80fd\u505a\u5230\u65e0\u72b6\u6001\u3002"),(0,l.kt)("h4",{id:"paths-in-visitors\u5b58\u5728\u4e8e\u8bbf\u95ee\u8005\u4e2d\u7684\u8def\u5f84"},(0,l.kt)("a",{id:"toc-paths-in-visitors"}),"Paths in Visitors\uff08\u5b58\u5728\u4e8e\u8bbf\u95ee\u8005\u4e2d\u7684\u8def\u5f84\uff09"),(0,l.kt)("p",null,"\u5f53\u4f60\u6709\u4e00\u4e2a ",(0,l.kt)("inlineCode",{parentName:"p"},"Identifier()")," \u6210\u5458\u65b9\u6cd5\u7684\u8bbf\u95ee\u8005\u65f6\uff0c\u4f60\u5b9e\u9645\u4e0a\u662f\u5728\u8bbf\u95ee\u8def\u5f84\u800c\u975e\u8282\u70b9\u3002 \u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\uff0c\u4f60\u64cd\u4f5c\u7684\u5c31\u662f\u8282\u70b9\u7684\u54cd\u5e94\u5f0f\u8868\u793a\uff08\u8bd1\u6ce8\uff1a\u5373\u8def\u5f84\uff09\u800c\u975e\u8282\u70b9\u672c\u8eab\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'const MyVisitor = {\n  Identifier(path) {\n    console.log("Visiting: " + path.node.name);\n  }\n};\n')),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"a + b + c;\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"path.traverse(MyVisitor);\nVisiting: a\nVisiting: b\nVisiting: c\n")),(0,l.kt)("h3",{id:"state\u72b6\u6001"},(0,l.kt)("a",{id:"toc-state"}),"State\uff08\u72b6\u6001\uff09"),(0,l.kt)("p",null,"\u72b6\u6001\u662f\u62bd\u8c61\u8bed\u6cd5\u6811AST\u8f6c\u6362\u7684\u654c\u4eba\uff0c\u72b6\u6001\u7ba1\u7406\u4f1a\u4e0d\u65ad\u7275\u626f\u4f60\u7684\u7cbe\u529b\uff0c\u800c\u4e14\u51e0\u4e4e\u6240\u6709\u4f60\u5bf9\u72b6\u6001\u7684\u5047\u8bbe\uff0c\u603b\u662f\u4f1a\u6709\u4e00\u4e9b\u672a\u8003\u8651\u5230\u7684\u8bed\u6cd5\u6700\u7ec8\u8bc1\u660e\u4f60\u7684\u5047\u8bbe\u662f\u9519\u8bef\u7684\u3002"),(0,l.kt)("p",null,"\u8003\u8651\u4e0b\u5217\u4ee3\u7801\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"function square(n) {\n  return n * n;\n}\n")),(0,l.kt)("p",null,"\u8ba9\u6211\u4eec\u5199\u4e00\u4e2a\u628a ",(0,l.kt)("inlineCode",{parentName:"p"},"n")," \u91cd\u547d\u540d\u4e3a ",(0,l.kt)("inlineCode",{parentName:"p"},"x")," \u7684\u8bbf\u95ee\u8005\u7684\u5feb\u901f\u5b9e\u73b0."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'let paramName;\n\nconst MyVisitor = {\n  FunctionDeclaration(path) {\n    const param = path.node.params[0];\n    paramName = param.name;\n    param.name = "x";\n  },\n\n  Identifier(path) {\n    if (path.node.name === paramName) {\n      path.node.name = "x";\n    }\n  }\n};\n')),(0,l.kt)("p",null,"\u5bf9\u4e0a\u9762\u7684\u4f8b\u5b50\u4ee3\u7801\u8fd9\u6bb5\u8bbf\u95ee\u8005\u4ee3\u7801\u4e5f\u8bb8\u80fd\u5de5\u4f5c\uff0c\u4f46\u5b83\u5f88\u5bb9\u6613\u88ab\u6253\u7834\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"function square(n) {\n  return n * n;\n}\nn;\n")),(0,l.kt)("p",null,"\u66f4\u597d\u7684\u5904\u7406\u65b9\u5f0f\u662f\u4f7f\u7528\u9012\u5f52\uff0c\u4e0b\u9762\u8ba9\u6211\u4eec\u6765\u50cf\u514b\u91cc\u65af\u6258\u4f5b\xb7\u8bfa\u5170\u7684\u7535\u5f71\u76d7\u68a6\u7a7a\u95f4\u90a3\u6837\u6765\u628a\u4e00\u4e2a\u8bbf\u95ee\u8005\u653e\u8fdb\u53e6\u5916\u4e00\u4e2a\u8bbf\u95ee\u8005\u91cc\u9762\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'const updateParamNameVisitor = {\n  Identifier(path) {\n    if (path.node.name === this.paramName) {\n      path.node.name = "x";\n    }\n  }\n};\n\nconst MyVisitor = {\n  FunctionDeclaration(path) {\n    const param = path.node.params[0];\n    const paramName = param.name;\n    param.name = "x";\n\n    path.traverse(updateParamNameVisitor, { paramName });\n  }\n};\n\npath.traverse(MyVisitor);\n')),(0,l.kt)("p",null,"\u5f53\u7136\uff0c\u8fd9\u53ea\u662f\u4e00\u4e2a\u523b\u610f\u7f16\u5199\u7684\u4f8b\u5b50\uff0c\u4e0d\u8fc7\u5b83\u6f14\u793a\u4e86\u5982\u4f55\u4ece\u8bbf\u95ee\u8005\u4e2d\u6d88\u9664\u5168\u5c40\u72b6\u6001\u3002"),(0,l.kt)("h3",{id:"scopes\u4f5c\u7528\u57df"},(0,l.kt)("a",{id:"toc-scopes"}),"Scopes\uff08\u4f5c\u7528\u57df\uff09"),(0,l.kt)("p",null,"\u63a5\u4e0b\u6765\u8ba9\u6211\u4eec\u4ecb\u7ecd",(0,l.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Scope_(computer_science)"},(0,l.kt)("strong",{parentName:"a"},"\u4f5c\u7528\u57df\uff08scope\uff09")),"\u7684\u6982\u5ff5\u3002 JavaScript \u652f\u6301",(0,l.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Scope_(computer_science)#Lexical_scoping_vs._dynamic_scoping"},"\u8bcd\u6cd5\u4f5c\u7528\u57df"),"\uff0c\u5728\u6811\u72b6\u5d4c\u5957\u7ed3\u6784\u4e2d\u4ee3\u7801\u5757\u521b\u5efa\u51fa\u65b0\u7684\u4f5c\u7528\u57df\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"// global scope\n\nfunction scopeOne() {\n  // scope 1\n\n  function scopeTwo() {\n    // scope 2\n  }\n}\n")),(0,l.kt)("p",null,"\u5728 JavaScript \u4e2d\uff0c\u6bcf\u5f53\u4f60\u521b\u5efa\u4e86\u4e00\u4e2a\u5f15\u7528\uff0c\u4e0d\u7ba1\u662f\u901a\u8fc7\u53d8\u91cf\uff08variable\uff09\u3001\u51fd\u6570\uff08function\uff09\u3001\u7c7b\u578b\uff08class\uff09\u3001\u53c2\u6570\uff08params\uff09\u3001\u6a21\u5757\u5bfc\u5165\uff08import\uff09\u8fd8\u662f\u6807\u7b7e\uff08label\uff09\u7b49\uff0c\u5b83\u90fd\u5c5e\u4e8e\u5f53\u524d\u4f5c\u7528\u57df\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'var global = "I am in the global scope";\n\nfunction scopeOne() {\n  var one = "I am in the scope created by `scopeOne()`";\n\n  function scopeTwo() {\n    var two = "I am in the scope created by `scopeTwo()`";\n  }\n}\n')),(0,l.kt)("p",null,"\u66f4\u6df1\u7684\u5185\u90e8\u4f5c\u7528\u57df\u4ee3\u7801\u53ef\u4ee5\u4f7f\u7528\u5916\u5c42\u4f5c\u7528\u57df\u4e2d\u7684\u5f15\u7528\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'function scopeOne() {\n  var one = "I am in the scope created by `scopeOne()`";\n\n  function scopeTwo() {\n    one = "I am updating the reference in `scopeOne` inside `scopeTwo`";\n  }\n}\n')),(0,l.kt)("p",null,"\u5185\u5c42\u4f5c\u7528\u57df\u4e5f\u53ef\u4ee5\u521b\u5efa\u548c\u5916\u5c42\u4f5c\u7528\u57df\u540c\u540d\u7684\u5f15\u7528\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'function scopeOne() {\n  var one = "I am in the scope created by `scopeOne()`";\n\n  function scopeTwo() {\n    var one = "I am creating a new `one` but leaving reference in `scopeOne()` alone.";\n  }\n}\n')),(0,l.kt)("p",null,"\u5f53\u7f16\u5199\u4e00\u4e2a\u8f6c\u6362\u65f6\uff0c\u5fc5\u987b\u5c0f\u5fc3\u4f5c\u7528\u57df\u3002\u6211\u4eec\u5f97\u786e\u4fdd\u5728\u6539\u53d8\u4ee3\u7801\u7684\u5404\u4e2a\u90e8\u5206\u65f6\u4e0d\u4f1a\u7834\u574f\u5df2\u7ecf\u5b58\u5728\u7684\u4ee3\u7801\u3002"),(0,l.kt)("p",null,"\u6211\u4eec\u5728\u6dfb\u52a0\u4e00\u4e2a\u65b0\u7684\u5f15\u7528\u65f6\u9700\u8981\u786e\u4fdd\u65b0\u589e\u52a0\u7684\u5f15\u7528\u540d\u5b57\u548c\u5df2\u6709\u7684\u6240\u6709\u5f15\u7528\u4e0d\u51b2\u7a81\u3002 \u6216\u8005\u6211\u4eec\u4ec5\u4ec5\u60f3\u627e\u51fa\u4f7f\u7528\u4e00\u4e2a\u53d8\u91cf\u7684\u6240\u6709\u5f15\u7528\uff0c \u6211\u4eec\u53ea\u60f3\u5728\u7ed9\u5b9a\u7684\u4f5c\u7528\u57df\uff08Scope\uff09\u4e2d\u627e\u51fa\u8fd9\u4e9b\u5f15\u7528\u3002"),(0,l.kt)("p",null,"\u4f5c\u7528\u57df\u53ef\u4ee5\u88ab\u8868\u793a\u4e3a\u5982\u4e0b\u5f62\u5f0f\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"{\n  path: path,\n  block: path.node,\n  parentBlock: path.parent,\n  parent: parentScope,\n  bindings: [...]\n}\n")),(0,l.kt)("p",null,"\u5f53\u4f60\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u4f5c\u7528\u57df\u65f6\uff0c\u9700\u8981\u7ed9\u51fa\u5b83\u7684\u8def\u5f84\u548c\u7236\u4f5c\u7528\u57df\uff0c\u4e4b\u540e\u5728\u904d\u5386\u8fc7\u7a0b\u4e2d\u5b83\u4f1a\u5728\u8be5\u4f5c\u7528\u57df\u5185\u6536\u96c6\u6240\u6709\u7684\u5f15\u7528(\u201c\u7ed1\u5b9a\u201d)\u3002"),(0,l.kt)("p",null,"\u4e00\u65e6\u5f15\u7528\u6536\u96c6\u5b8c\u6bd5\uff0c\u4f60\u5c31\u53ef\u4ee5\u5728\u4f5c\u7528\u57df\uff08Scopes\uff09\u4e0a\u4f7f\u7528\u5404\u79cd\u65b9\u6cd5\uff0c\u7a0d\u540e\u6211\u4eec\u4f1a\u4e86\u89e3\u8fd9\u4e9b\u65b9\u6cd5\u3002"),(0,l.kt)("h4",{id:"bindings\u7ed1\u5b9a"},(0,l.kt)("a",{id:"toc-bindings"}),"Bindings\uff08\u7ed1\u5b9a\uff09"),(0,l.kt)("p",null,"\u6240\u6709\u5f15\u7528\u5c5e\u4e8e\u7279\u5b9a\u7684\u4f5c\u7528\u57df\uff0c\u5f15\u7528\u548c\u4f5c\u7528\u57df\u7684\u8fd9\u79cd\u5173\u7cfb\u88ab\u79f0\u4f5c\uff1a",(0,l.kt)("strong",{parentName:"p"},"\u7ed1\u5b9a\uff08binding\uff09"),"\u3002."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'function scopeOnce() {\n  var ref = "This is a binding";\n\n  ref; // This is a reference to a binding\n\n  function scopeTwo() {\n    ref; // This is a reference to a binding from a lower scope\n  }\n}\n')),(0,l.kt)("p",null,"\u5355\u4e2a\u7ed1\u5b9a\u770b\u8d77\u6765\u50cf\u8fd9\u6837\ufe30"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"Text for Translation\n{\n  identifier: node,\n  scope: scope,\n  path: path,\n  kind: 'var',\n\n  referenced: true,\n  references: 3,\n  referencePaths: [path, path, path],\n\n  constant: false,\n  constantViolations: [path]\n}\n")),(0,l.kt)("p",null,"\u6709\u4e86\u8fd9\u4e9b\u4fe1\u606f\u4f60\u5c31\u53ef\u4ee5\u67e5\u627e\u4e00\u4e2a\u7ed1\u5b9a\u7684\u6240\u6709\u5f15\u7528\uff0c\u5e76\u4e14\u77e5\u9053\u8fd9\u662f\u4ec0\u4e48\u7c7b\u578b\u7684\u7ed1\u5b9a(\u53c2\u6570\uff0c\u5b9a\u4e49\u7b49\u7b49)\uff0c\u67e5\u627e\u5b83\u6240\u5c5e\u7684\u4f5c\u7528\u57df\uff0c\u6216\u8005\u62f7\u8d1d\u5b83\u7684\u6807\u8bc6\u7b26\u3002 \u4f60\u751a\u81f3\u53ef\u4ee5\u77e5\u9053\u5b83\u662f\u4e0d\u662f\u5e38\u91cf\uff0c\u5982\u679c\u4e0d\u662f\uff0c\u90a3\u4e48\u662f\u54ea\u4e2a\u8def\u5f84\u4fee\u6539\u4e86\u5b83\u3002"),(0,l.kt)("p",null,"\u5728\u5f88\u591a\u60c5\u51b5\u4e0b\uff0c\u77e5\u9053\u4e00\u4e2a\u7ed1\u5b9a\u662f\u5426\u662f\u5e38\u91cf\u975e\u5e38\u6709\u7528\uff0c\u6700\u6709\u7528\u7684\u4e00\u79cd\u60c5\u5f62\u5c31\u662f\u4ee3\u7801\u538b\u7f29\u65f6\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'function scopeOne() {\n  var ref1 = "This is a constant binding";\n\n  becauseNothingEverChangesTheValueOf(ref1);\n\n  function scopeTwo() {\n    var ref2 = "This is *not* a constant binding";\n    ref2 = "Because this changes the value";\n  }\n}\n')),(0,l.kt)("hr",null),(0,l.kt)("h1",{id:"api"},(0,l.kt)("a",{id:"toc-api"}),"API"),(0,l.kt)("p",null,"Babel \u5b9e\u9645\u4e0a\u662f\u4e00\u7ec4\u6a21\u5757\u7684\u96c6\u5408\u3002\u672c\u8282\u6211\u4eec\u5c06\u63a2\u7d22\u4e00\u4e9b\u4e3b\u8981\u7684\u6a21\u5757\uff0c\u89e3\u91ca\u5b83\u4eec\u662f\u505a\u4ec0\u4e48\u7684\u4ee5\u53ca\u5982\u4f55\u4f7f\u7528\u5b83\u4eec\u3002"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u6ce8\u610f\uff1a\u672c\u8282\u5185\u5bb9\u4e0d\u662f\u8be6\u7ec6\u7684 API \u6587\u6863\u7684\u66ff\u4ee3\u54c1\uff0c\u6b63\u5f0f\u7684 API \u6587\u6863\u5c06\u5f88\u5feb\u63d0\u4f9b\u51fa\u6765\u3002")),(0,l.kt)("h2",{id:"babylon"},(0,l.kt)("a",{id:"toc-babylon"}),(0,l.kt)("a",{parentName:"h2",href:"https://github.com/babel/babylon"},(0,l.kt)("inlineCode",{parentName:"a"},"babylon"))),(0,l.kt)("p",null,"Babylon \u662f Babel \u7684\u89e3\u6790\u5668\u3002\u6700\u521d\u662f \u4eceAcorn\u9879\u76eefork\u51fa\u6765\u7684\u3002Acorn\u975e\u5e38\u5feb\uff0c\u6613\u4e8e\u4f7f\u7528\uff0c\u5e76\u4e14\u9488\u5bf9\u975e\u6807\u51c6\u7279\u6027(\u4ee5\u53ca\u90a3\u4e9b\u672a\u6765\u7684\u6807\u51c6\u7279\u6027) \u8bbe\u8ba1\u4e86\u4e00\u4e2a\u57fa\u4e8e\u63d2\u4ef6\u7684\u67b6\u6784\u3002"),(0,l.kt)("p",null,"\u9996\u5148\uff0c\u8ba9\u6211\u4eec\u5b89\u88c5\u5b83\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sh"},"$ npm install --save babylon\n")),(0,l.kt)("p",null,"\u5148\u4ece\u89e3\u6790\u4e00\u4e2a\u4ee3\u7801\u5b57\u7b26\u4e32\u5f00\u59cb\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'import * as babylon from "babylon";\n\nconst code = `function square(n) {\n  return n * n;\n}`;\n\nbabylon.parse(code);\n// Node {\n//   type: "File",\n//   start: 0,\n//   end: 38,\n//   loc: SourceLocation {...},\n//   program: Node {...},\n//   comments: [],\n//   tokens: [...]\n// }\n')),(0,l.kt)("p",null,"\u6211\u4eec\u8fd8\u80fd\u50cf\u4e0b\u9762\u8fd9\u6837\u4f20\u9012\u9009\u9879\u7ed9 ",(0,l.kt)("inlineCode",{parentName:"p"},"parse()"),"\u65b9\u6cd5\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'babylon.parse(code, {\n  sourceType: "module", // default: "script"\n  plugins: ["jsx"] // default: []\n});\n')),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"sourceType")," \u53ef\u4ee5\u662f ",(0,l.kt)("inlineCode",{parentName:"p"},'"module"')," \u6216\u8005 ",(0,l.kt)("inlineCode",{parentName:"p"},'"script"'),"\uff0c\u5b83\u8868\u793a Babylon \u5e94\u8be5\u7528\u54ea\u79cd\u6a21\u5f0f\u6765\u89e3\u6790\u3002 ",(0,l.kt)("inlineCode",{parentName:"p"},'"module"')," \u5c06\u4f1a\u5728\u4e25\u683c\u6a21\u5f0f\u4e0b\u89e3\u6790\u5e76\u4e14\u5141\u8bb8\u6a21\u5757\u5b9a\u4e49\uff0c",(0,l.kt)("inlineCode",{parentName:"p"},'"script"')," \u5219\u4e0d\u4f1a\u3002"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},(0,l.kt)("strong",{parentName:"p"},"\u6ce8\u610f\uff1a")," ",(0,l.kt)("inlineCode",{parentName:"p"},"sourceType")," \u7684\u9ed8\u8ba4\u503c\u662f ",(0,l.kt)("inlineCode",{parentName:"p"},'"script"')," \u5e76\u4e14\u5728\u53d1\u73b0 ",(0,l.kt)("inlineCode",{parentName:"p"},"import")," \u6216 ",(0,l.kt)("inlineCode",{parentName:"p"},"export")," \u65f6\u4ea7\u751f\u9519\u8bef\u3002 \u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},'scourceType: "module"')," \u6765\u907f\u514d\u8fd9\u4e9b\u9519\u8bef\u3002")),(0,l.kt)("p",null,"\u7531\u4e8e Babylon \u4f7f\u7528\u4e86\u57fa\u4e8e\u63d2\u4ef6\u7684\u67b6\u6784\uff0c\u56e0\u6b64\u6709\u4e00\u4e2a ",(0,l.kt)("inlineCode",{parentName:"p"},"plugins")," \u9009\u9879\u53ef\u4ee5\u5f00\u5173\u5185\u7f6e\u7684\u63d2\u4ef6\u3002 \u6ce8\u610f Babylon \u5c1a\u672a\u5bf9\u5916\u90e8\u63d2\u4ef6\u5f00\u653e\u6b64 API \u63a5\u53e3\uff0c\u4e0d\u6392\u9664\u672a\u6765\u4f1a\u5f00\u653e\u6b64API\u3002"),(0,l.kt)("p",null,"\u8981\u67e5\u770b\u5b8c\u6574\u7684\u63d2\u4ef6\u5217\u8868\uff0c\u8bf7\u53c2\u89c1 ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/babel/babylon/blob/master/README.md#plugins"},"Babylon README"),"\u6587\u4ef6\u3002."),(0,l.kt)("h2",{id:"babel-traverse"},(0,l.kt)("a",{id:"toc-babel-traverse"}),(0,l.kt)("a",{parentName:"h2",href:"https://github.com/babel/babel/tree/master/packages/babel-traverse"},(0,l.kt)("inlineCode",{parentName:"a"},"babel-traverse"))),(0,l.kt)("p",null,"Babel Traverse\uff08\u904d\u5386\uff09\u6a21\u5757\u7ef4\u62a4\u4e86\u6574\u68f5\u6811\u7684\u72b6\u6001\uff0c\u5e76\u4e14\u8d1f\u8d23\u66ff\u6362\u3001\u79fb\u9664\u548c\u6dfb\u52a0\u8282\u70b9\u3002"),(0,l.kt)("p",null,"\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\u5b89\u88c5\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sh"},"$ npm install --save babel-traverse\n")),(0,l.kt)("p",null,"\u6211\u4eec\u53ef\u4ee5\u548c Babylon \u4e00\u8d77\u4f7f\u7528\u6765\u904d\u5386\u548c\u66f4\u65b0\u8282\u70b9\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'import * as babylon from "babylon";\nimport traverse from "babel-traverse";\n\nconst code = `function square(n) {\n  return n * n;\n}`;\n\nconst ast = babylon.parse(code);\n\ntraverse(ast, {\n  enter(path) {\n    if (\n      path.node.type === "Identifier" &&\n      path.node.name === "n"\n    ) {\n      path.node.name = "x";\n    }\n  }\n});\n')),(0,l.kt)("h2",{id:"babel-types"},(0,l.kt)("a",{id:"toc-babel-types"}),(0,l.kt)("a",{parentName:"h2",href:"https://github.com/babel/babel/tree/master/packages/babel-types"},(0,l.kt)("inlineCode",{parentName:"a"},"babel-types"))),(0,l.kt)("p",null,"Babel Types\u6a21\u5757\u662f\u4e00\u4e2a\u7528\u4e8e AST \u8282\u70b9\u7684 Lodash \u5f0f\u5de5\u5177\u5e93\uff08\u8bd1\u6ce8\uff1aLodash \u662f\u4e00\u4e2a JavaScript \u51fd\u6570\u5de5\u5177\u5e93\uff0c\u63d0\u4f9b\u4e86\u57fa\u4e8e\u51fd\u6570\u5f0f\u7f16\u7a0b\u98ce\u683c\u7684\u4f17\u591a\u5de5\u5177\u51fd\u6570\uff09\uff0c \u5b83\u5305\u542b\u4e86\u6784\u9020\u3001\u9a8c\u8bc1\u4ee5\u53ca\u53d8\u6362 AST \u8282\u70b9\u7684\u65b9\u6cd5\u3002 \u8be5\u5de5\u5177\u5e93\u5305\u542b\u8003\u8651\u5468\u5230\u7684\u5de5\u5177\u65b9\u6cd5\uff0c\u5bf9\u7f16\u5199\u5904\u7406AST\u903b\u8f91\u975e\u5e38\u6709\u7528\u3002"),(0,l.kt)("p",null,"\u53ef\u4ee5\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\u6765\u5b89\u88c5\u5b83\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sh"},"$ npm install --save babel-types\n")),(0,l.kt)("p",null,"\u7136\u540e\u6309\u5982\u4e0b\u6240\u793a\u6765\u4f7f\u7528\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'import traverse from "babel-traverse";\nimport * as t from "babel-types";\n\ntraverse(ast, {\n  enter(path) {\n    if (t.isIdentifier(path.node, { name: "n" })) {\n      path.node.name = "x";\n    }\n  }\n});\n')),(0,l.kt)("h3",{id:"definitions\u5b9a\u4e49"},(0,l.kt)("a",{id:"toc-definitions"}),"Definitions\uff08\u5b9a\u4e49\uff09"),(0,l.kt)("p",null,"Babel Types\u6a21\u5757\u62e5\u6709\u6bcf\u4e00\u4e2a\u5355\u4e00\u7c7b\u578b\u8282\u70b9\u7684\u5b9a\u4e49\uff0c\u5305\u62ec\u8282\u70b9\u5305\u542b\u54ea\u4e9b\u5c5e\u6027\uff0c\u4ec0\u4e48\u662f\u5408\u6cd5\u503c\uff0c\u5982\u4f55\u6784\u5efa\u8282\u70b9\u3001\u904d\u5386\u8282\u70b9\uff0c\u4ee5\u53ca\u8282\u70b9\u7684\u522b\u540d\u7b49\u4fe1\u606f\u3002"),(0,l.kt)("p",null,"\u5355\u4e00\u8282\u70b9\u7c7b\u578b\u7684\u5b9a\u4e49\u5f62\u5f0f\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'defineType("BinaryExpression", {\n  builder: ["operator", "left", "right"],\n  fields: {\n    operator: {\n      validate: assertValueType("string")\n    },\n    left: {\n      validate: assertNodeType("Expression")\n    },\n    right: {\n      validate: assertNodeType("Expression")\n    }\n  },\n  visitor: ["left", "right"],\n  aliases: ["Binary", "Expression"]\n});\n')),(0,l.kt)("h3",{id:"builders\u6784\u5efa\u5668"},(0,l.kt)("a",{id:"toc-builders"}),"Builders\uff08\u6784\u5efa\u5668\uff09"),(0,l.kt)("p",null,"\u4f60\u4f1a\u6ce8\u610f\u5230\u4e0a\u9762\u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"BinaryExpression")," \u5b9a\u4e49\u6709\u4e00\u4e2a ",(0,l.kt)("inlineCode",{parentName:"p"},"builder")," \u5b57\u6bb5\u3002."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'builder: ["operator", "left", "right"]\n')),(0,l.kt)("p",null,"\u8fd9\u662f\u7531\u4e8e\u6bcf\u4e00\u4e2a\u8282\u70b9\u7c7b\u578b\u90fd\u6709\u6784\u9020\u5668\u65b9\u6cd5builder\uff0c\u6309\u7c7b\u4f3c\u4e0b\u9762\u7684\u65b9\u5f0f\u4f7f\u7528\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'t.binaryExpression("*", t.identifier("a"), t.identifier("b"));\n')),(0,l.kt)("p",null,"\u53ef\u4ee5\u521b\u5efa\u5982\u4e0b\u6240\u793a\u7684 AST\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'{\n  type: "BinaryExpression",\n  operator: "*",\n  left: {\n    type: "Identifier",\n    name: "a"\n  },\n  right: {\n    type: "Identifier",\n    name: "b"\n  }\n}\n')),(0,l.kt)("p",null,"\u5f53\u6253\u5370\u51fa\u6765\u4e4b\u540e\u662f\u8fd9\u6837\u7684\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"a * b\n")),(0,l.kt)("p",null,"\u6784\u9020\u5668\u8fd8\u4f1a\u9a8c\u8bc1\u81ea\u8eab\u521b\u5efa\u7684\u8282\u70b9\uff0c\u5e76\u5728\u9519\u8bef\u4f7f\u7528\u7684\u60c5\u5f62\u4e0b\u4f1a\u629b\u51fa\u63cf\u8ff0\u6027\u9519\u8bef\uff0c\u8fd9\u5c31\u5f15\u51fa\u4e86\u4e0b\u4e00\u4e2a\u65b9\u6cd5\u7c7b\u578b\u3002"),(0,l.kt)("h3",{id:"validators\u9a8c\u8bc1\u5668"},(0,l.kt)("a",{id:"toc-validators"}),"Validators\uff08\u9a8c\u8bc1\u5668\uff09"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"BinaryExpression")," \u7684\u5b9a\u4e49\u8fd8\u5305\u542b\u4e86\u8282\u70b9\u7684\u5b57\u6bb5 ",(0,l.kt)("inlineCode",{parentName:"p"},"fields")," \u4fe1\u606f\uff0c\u4ee5\u53ca\u5982\u4f55\u9a8c\u8bc1\u8fd9\u4e9b\u5b57\u6bb5\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'fields: {\n  operator: {\n    validate: assertValueType("string")\n  },\n  left: {\n    validate: assertNodeType("Expression")\n  },\n  right: {\n    validate: assertNodeType("Expression")\n  }\n}\n')),(0,l.kt)("p",null,"\u53ef\u4ee5\u521b\u5efa\u4e24\u79cd\u9a8c\u8bc1\u65b9\u6cd5\u3002\u7b2c\u4e00\u79cd\u662f ",(0,l.kt)("inlineCode",{parentName:"p"},"isX"),"\u3002."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"t.isBinaryExpression(maybeBinaryExpressionNode);\n")),(0,l.kt)("p",null,"\u8fd9\u4e2a\u6d4b\u8bd5\u7528\u6765\u786e\u4fdd\u8282\u70b9\u662f\u4e00\u4e2a\u4e8c\u8fdb\u5236\u8868\u8fbe\u5f0f\uff0c\u53e6\u5916\u4f60\u4e5f\u53ef\u4ee5\u4f20\u5165\u7b2c\u4e8c\u4e2a\u53c2\u6570\u6765\u786e\u4fdd\u8282\u70b9\u5305\u542b\u7279\u5b9a\u7684\u5c5e\u6027\u548c\u503c\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'t.isBinaryExpression(maybeBinaryExpressionNode, { operator: "*" });\n')),(0,l.kt)("p",null,"\u8fd9\u4e9b\u65b9\u6cd5\u8fd8\u6709\u4e00\u79cd\u65ad\u8a00\u5f0f\u7684\u7248\u672c\uff0c\u4f1a\u629b\u51fa\u5f02\u5e38\u800c\u4e0d\u662f\u8fd4\u56de ",(0,l.kt)("inlineCode",{parentName:"p"},"true")," \u6216 ",(0,l.kt)("inlineCode",{parentName:"p"},"false"),"\u3002."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'t.assertBinaryExpression(maybeBinaryExpressionNode);\nt.assertBinaryExpression(maybeBinaryExpressionNode, { operator: "*" });\n// Error: Expected type "BinaryExpression" with option { "operator": "*" }\n')),(0,l.kt)("h3",{id:"converters\u53d8\u6362\u5668"},(0,l.kt)("a",{id:"toc-converters"}),"Converters\uff08\u53d8\u6362\u5668\uff09"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"[WIP]")),(0,l.kt)("h2",{id:"babel-generator"},(0,l.kt)("a",{id:"toc-babel-generator"}),(0,l.kt)("a",{parentName:"h2",href:"https://github.com/babel/babel/tree/master/packages/babel-generator"},(0,l.kt)("inlineCode",{parentName:"a"},"babel-generator"))),(0,l.kt)("p",null,"Babel Generator\u6a21\u5757\u662f Babel \u7684\u4ee3\u7801\u751f\u6210\u5668\uff0c\u5b83\u8bfb\u53d6AST\u5e76\u5c06\u5176\u8f6c\u6362\u4e3a\u4ee3\u7801\u548c\u6e90\u7801\u6620\u5c04\uff08sourcemaps\uff09\u3002"),(0,l.kt)("p",null,"\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\u6765\u5b89\u88c5\u5b83\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sh"},"$ npm install --save babel-generator\n")),(0,l.kt)("p",null,"\u7136\u540e\u6309\u5982\u4e0b\u65b9\u5f0f\u4f7f\u7528\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'import * as babylon from "babylon";\nimport generate from "babel-generator";\n\nconst code = `function square(n) {\n  return n * n;\n}`;\n\nconst ast = babylon.parse(code);\n\ngenerate(ast, {}, code);\n// {\n//   code: "...",\n//   map: "..."\n// }\n')),(0,l.kt)("p",null,"\u4f60\u4e5f\u53ef\u4ee5\u7ed9 ",(0,l.kt)("inlineCode",{parentName:"p"},"generate()")," \u65b9\u6cd5\u4f20\u9012\u9009\u9879\u3002."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'generate(ast, {\n  retainLines: false,\n  compact: "auto",\n  concise: false,\n  quotes: "double",\n  // ...\n}, code);\n')),(0,l.kt)("h2",{id:"babel-template"},(0,l.kt)("a",{id:"toc-babel-template"}),(0,l.kt)("a",{parentName:"h2",href:"https://github.com/babel/babel/tree/master/packages/babel-template"},(0,l.kt)("inlineCode",{parentName:"a"},"babel-template"))),(0,l.kt)("p",null,"babel-template \u662f\u53e6\u4e00\u4e2a\u867d\u7136\u5f88\u5c0f\u4f46\u5374\u975e\u5e38\u6709\u7528\u7684\u6a21\u5757\u3002 \u5b83\u80fd\u8ba9\u4f60\u7f16\u5199\u5b57\u7b26\u4e32\u5f62\u5f0f\u4e14\u5e26\u6709\u5360\u4f4d\u7b26\u7684\u4ee3\u7801\u6765\u4ee3\u66ff\u624b\u52a8\u7f16\u7801\uff0c \u5c24\u5176\u662f\u751f\u6210\u7684\u5927\u89c4\u6a21 AST\u7684\u65f6\u5019\u3002 \u5728\u8ba1\u7b97\u673a\u79d1\u5b66\u4e2d\uff0c\u8fd9\u79cd\u80fd\u529b\u88ab\u79f0\u4e3a\u51c6\u5f15\u7528\uff08quasiquotes\uff09\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sh"},"$ npm install --save babel-template\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'import template from "babel-template";\nimport generate from "babel-generator";\nimport * as t from "babel-types";\n\nconst buildRequire = template(`\n  var IMPORT_NAME = require(SOURCE);\n`);\nconst ast = buildRequire({\n  IMPORT_NAME: t.identifier("myModule"),\n  SOURCE: t.stringLiteral("my-module")\n});\nconsole.log(generate(ast).code);\n')),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'var myModule = require("my-module");\n')),(0,l.kt)("h1",{id:"\u7f16\u5199\u4f60\u7684\u7b2c\u4e00\u4e2a-babel-\u63d2\u4ef6"},(0,l.kt)("a",{id:"toc-writing-your-first-babel-plugin"}),"\u7f16\u5199\u4f60\u7684\u7b2c\u4e00\u4e2a Babel \u63d2\u4ef6"),(0,l.kt)("p",null,"\u73b0\u5728\u4f60\u5df2\u7ecf\u719f\u6089\u4e86 Babel \u7684\u6240\u6709\u57fa\u7840\u77e5\u8bc6\u4e86\uff0c\u8ba9\u6211\u4eec\u628a\u8fd9\u4e9b\u77e5\u8bc6\u548c\u63d2\u4ef6\u7684 API\u878d\u5408\u5728\u4e00\u8d77\u6765\u7f16\u5199\u7b2c\u4e00\u4e2a Babel \u63d2\u4ef6\u5427\u3002"),(0,l.kt)("p",null,"\u5148\u4ece\u4e00\u4e2a\u63a5\u6536\u4e86\u5f53\u524d",(0,l.kt)("inlineCode",{parentName:"p"},"babel"),"\u5bf9\u8c61\u4f5c\u4e3a\u53c2\u6570\u7684 ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/babel/babel/tree/master/packages/babel-core"},(0,l.kt)("inlineCode",{parentName:"a"},"function"))," \u5f00\u59cb\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"export default function(babel) {\n  // plugin contents\n}\n")),(0,l.kt)("p",null,"\u7531\u4e8e\u4f60\u5c06\u4f1a\u7ecf\u5e38\u8fd9\u6837\u4f7f\u7528\uff0c\u6240\u4ee5\u76f4\u63a5\u53d6\u51fa ",(0,l.kt)("inlineCode",{parentName:"p"},"babel.types")," \u4f1a\u66f4\u65b9\u4fbf\uff1a\uff08\u8bd1\u6ce8\uff1a\u8fd9\u662f ES2015 \u8bed\u6cd5\u4e2d\u7684\u5bf9\u8c61\u89e3\u6784\uff0c\u5373 Destructuring\uff09"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"export default function({ types: t }) {\n  // plugin contents\n}\n")),(0,l.kt)("p",null,"\u63a5\u7740\u8fd4\u56de\u4e00\u4e2a\u5bf9\u8c61\uff0c\u5176 ",(0,l.kt)("inlineCode",{parentName:"p"},"visitor")," \u5c5e\u6027\u662f\u8fd9\u4e2a\u63d2\u4ef6\u7684\u4e3b\u8981\u8bbf\u95ee\u8005\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"export default function({ types: t }) {\n  return {\n    visitor: {\n      // visitor contents\n    }\n  };\n};\n")),(0,l.kt)("p",null,"Visitor \u4e2d\u7684\u6bcf\u4e2a\u51fd\u6570\u63a5\u65362\u4e2a\u53c2\u6570\uff1a",(0,l.kt)("inlineCode",{parentName:"p"},"path")," \u548c ",(0,l.kt)("inlineCode",{parentName:"p"},"state")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"export default function({ types: t }) {\n  return {\n    visitor: {\n      Identifier(path, state) {},\n      ASTNodeTypeHere(path, state) {}\n    }\n  };\n};\n")),(0,l.kt)("p",null,"\u8ba9\u6211\u4eec\u5feb\u901f\u7f16\u5199\u4e00\u4e2a\u53ef\u7528\u7684\u63d2\u4ef6\u6765\u5c55\u793a\u4e00\u4e0b\u5b83\u662f\u5982\u4f55\u5de5\u4f5c\u7684\u3002\u4e0b\u9762\u662f\u6211\u4eec\u7684\u6e90\u4ee3\u7801\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"foo === bar;\n")),(0,l.kt)("p",null,"\u5176 AST \u5f62\u5f0f\u5982\u4e0b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'{\n  type: "BinaryExpression",\n  operator: "===",\n  left: {\n    type: "Identifier",\n    name: "foo"\n  },\n  right: {\n    type: "Identifier",\n    name: "bar"\n  }\n}\n')),(0,l.kt)("p",null,"\u6211\u4eec\u4ece\u6dfb\u52a0 ",(0,l.kt)("inlineCode",{parentName:"p"},"BinaryExpression")," \u8bbf\u95ee\u8005\u65b9\u6cd5\u5f00\u59cb\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"export default function({ types: t }) {\n  return {\n    visitor: {\n      BinaryExpression(path) {\n        // ...\n      }\n    }\n  };\n}\n")),(0,l.kt)("p",null,"\u7136\u540e\u6211\u4eec\u66f4\u786e\u5207\u4e00\u4e9b\uff0c\u53ea\u5173\u6ce8\u54ea\u4e9b\u4f7f\u7528\u4e86 ",(0,l.kt)("inlineCode",{parentName:"p"},"===")," \u7684 ",(0,l.kt)("inlineCode",{parentName:"p"},"BinaryExpression"),"\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'visitor: {\n  BinaryExpression(path) {\n    if (path.node.operator !== "===") {\n      return;\n    }\n\n    // ...\n  }\n}\n')),(0,l.kt)("p",null,"\u73b0\u5728\u6211\u4eec\u7528\u65b0\u7684\u6807\u8bc6\u7b26\u6765\u66ff\u6362 ",(0,l.kt)("inlineCode",{parentName:"p"},"left")," \u5c5e\u6027\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'BinaryExpression(path) {\n  if (path.node.operator !== "===") {\n    return;\n  }\n\n  path.node.left = t.identifier("sebmck");\n  // ...\n}\n')),(0,l.kt)("p",null,"\u4e8e\u662f\u5982\u679c\u6211\u4eec\u8fd0\u884c\u8fd9\u4e2a\u63d2\u4ef6\u6211\u4eec\u4f1a\u5f97\u5230\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"sebmck === bar;\n")),(0,l.kt)("p",null,"\u73b0\u5728\u53ea\u9700\u8981\u66ff\u6362 ",(0,l.kt)("inlineCode",{parentName:"p"},"right")," \u5c5e\u6027\u4e86\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'BinaryExpression(path) {\n  if (path.node.operator !== "===") {\n    return;\n  }\n\n  path.node.left = t.identifier("sebmck");\n  path.node.right = t.identifier("dork");\n}\n')),(0,l.kt)("p",null,"\u8fd9\u5c31\u662f\u6211\u4eec\u7684\u6700\u7ec8\u7ed3\u679c\u4e86\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"sebmck === dork;\n")),(0,l.kt)("p",null,"\u5b8c\u7f8e\uff01\u6211\u4eec\u7684\u7b2c\u4e00\u4e2a Babel \u63d2\u4ef6\u3002"),(0,l.kt)("hr",null),(0,l.kt)("h1",{id:"\u8f6c\u6362\u64cd\u4f5c"},(0,l.kt)("a",{id:"toc-transformation-operations"}),"\u8f6c\u6362\u64cd\u4f5c"),(0,l.kt)("h2",{id:"\u8bbf\u95ee"},(0,l.kt)("a",{id:"toc-visiting"}),"\u8bbf\u95ee"),(0,l.kt)("h3",{id:"\u83b7\u53d6\u5b50\u8282\u70b9\u7684path"},(0,l.kt)("a",{id:"toc-get-the-path-of-a-sub-node"}),"\u83b7\u53d6\u5b50\u8282\u70b9\u7684Path"),(0,l.kt)("p",null,"\u4e3a\u4e86\u5f97\u5230\u4e00\u4e2aAST\u8282\u70b9\u7684\u5c5e\u6027\u503c\uff0c\u6211\u4eec\u4e00\u822c\u5148\u8bbf\u95ee\u5230\u8be5\u8282\u70b9\uff0c\u7136\u540e\u5229\u7528 ",(0,l.kt)("inlineCode",{parentName:"p"},"path.node.property")," \u65b9\u6cd5\u5373\u53ef\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"// the BinaryExpression AST node has properties: `left`, `right`, `operator`\nBinaryExpression(path) {\n  path.node.left;\n  path.node.right;\n  path.node.operator;\n}\n")),(0,l.kt)("p",null,"\u5982\u679c\u4f60\u60f3\u8bbf\u95ee\u5230\u8be5\u5c5e\u6027\u5185\u90e8\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"path"),"\uff0c\u4f7f\u7528path\u5bf9\u8c61\u7684",(0,l.kt)("inlineCode",{parentName:"p"},"get"),"\u65b9\u6cd5\uff0c\u4f20\u9012\u8be5\u5c5e\u6027\u7684\u5b57\u7b26\u4e32\u5f62\u5f0f\u4f5c\u4e3a\u53c2\u6570\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"BinaryExpression(path) {\n  path.get('left');\n}\nProgram(path) {\n  path.get('body.0');\n}\n")),(0,l.kt)("h3",{id:"\u68c0\u67e5\u8282\u70b9\u7684\u7c7b\u578b"},(0,l.kt)("a",{id:"toc-check-if-a-node-is-a-certain-type"}),"\u68c0\u67e5\u8282\u70b9\u7684\u7c7b\u578b"),(0,l.kt)("p",null,"\u5982\u679c\u4f60\u60f3\u68c0\u67e5\u8282\u70b9\u7684\u7c7b\u578b\uff0c\u6700\u597d\u7684\u65b9\u5f0f\u662f\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"BinaryExpression(path) {\n  if (t.isIdentifier(path.node.left)) {\n    // ...\n  }\n}\n")),(0,l.kt)("p",null,"\u4f60\u540c\u6837\u53ef\u4ee5\u5bf9\u8282\u70b9\u7684\u5c5e\u6027\u4eec\u505a\u6d45\u5c42\u68c0\u67e5\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'BinaryExpression(path) {\n  if (t.isIdentifier(path.node.left, { name: "n" })) {\n    // ...\n  }\n}\n')),(0,l.kt)("p",null,"\u529f\u80fd\u4e0a\u7b49\u4ef7\u4e8e\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'BinaryExpression(path) {\n  if (\n    path.node.left != null &&\n    path.node.left.type === "Identifier" &&\n    path.node.left.name === "n"\n  ) {\n    // ...\n  }\n}\n')),(0,l.kt)("h3",{id:"\u68c0\u67e5\u8def\u5f84path\u7c7b\u578b"},(0,l.kt)("a",{id:"toc-check-if-a-path-is-a-certain-type"}),"\u68c0\u67e5\u8def\u5f84\uff08Path\uff09\u7c7b\u578b"),(0,l.kt)("p",null,"\u4e00\u4e2a\u8def\u5f84\u5177\u6709\u76f8\u540c\u7684\u65b9\u6cd5\u68c0\u67e5\u8282\u70b9\u7684\u7c7b\u578b\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"BinaryExpression(path) {\n  if (path.get('left').isIdentifier({ name: \"n\" })) {\n    // ...\n  }\n}\n")),(0,l.kt)("p",null,"\u5c31\u76f8\u5f53\u4e8e\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'BinaryExpression(path) {\n  if (t.isIdentifier(path.node.left, { name: "n" })) {\n    // ...\n  }\n}\n')),(0,l.kt)("h3",{id:"\u68c0\u67e5\u6807\u8bc6\u7b26identifier\u662f\u5426\u88ab\u5f15\u7528"},(0,l.kt)("a",{id:"toc-check-if-an-identifier-is-referenced"}),"\u68c0\u67e5\u6807\u8bc6\u7b26\uff08Identifier\uff09\u662f\u5426\u88ab\u5f15\u7528"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"Identifier(path) {\n  if (path.isReferencedIdentifier()) {\n    // ...\n  }\n}\n")),(0,l.kt)("p",null,"\u6216\u8005\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"Identifier(path) {\n  if (t.isReferenced(path.node, path.parent)) {\n    // ...\n  }\n}\n")),(0,l.kt)("h3",{id:"\u627e\u5230\u7279\u5b9a\u7684\u7236\u8def\u5f84"},(0,l.kt)("a",{id:"toc-find-a-specific-parent-path"}),"\u627e\u5230\u7279\u5b9a\u7684\u7236\u8def\u5f84"),(0,l.kt)("p",null,"\u6709\u65f6\u4f60\u9700\u8981\u4ece\u4e00\u4e2a\u8def\u5f84\u5411\u4e0a\u904d\u5386\u8bed\u6cd5\u6811\uff0c\u76f4\u5230\u6ee1\u8db3\u76f8\u5e94\u7684\u6761\u4ef6\u3002"),(0,l.kt)("p",null,"\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u7236\u8def\u5f84\u8c03\u7528",(0,l.kt)("inlineCode",{parentName:"p"},"callback"),"\u5e76\u5c06\u5176",(0,l.kt)("inlineCode",{parentName:"p"},"NodePath"),"\u5f53\u4f5c\u53c2\u6570\uff0c\u5f53",(0,l.kt)("inlineCode",{parentName:"p"},"callback"),"\u8fd4\u56de\u771f\u503c\u65f6\uff0c\u5219\u5c06\u5176",(0,l.kt)("inlineCode",{parentName:"p"},"NodePath"),"\u8fd4\u56de\u3002."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"path.findParent((path) => path.isObjectExpression());\n")),(0,l.kt)("p",null,"\u5982\u679c\u4e5f\u9700\u8981\u904d\u5386\u5f53\u524d\u8282\u70b9\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"path.find((path) => path.isObjectExpression());\n")),(0,l.kt)("p",null,"\u67e5\u627e\u6700\u63a5\u8fd1\u7684\u7236\u51fd\u6570\u6216\u7a0b\u5e8f\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"path.getFunctionParent();\n")),(0,l.kt)("p",null,"\u5411\u4e0a\u904d\u5386\u8bed\u6cd5\u6811\uff0c\u76f4\u5230\u627e\u5230\u5728\u5217\u8868\u4e2d\u7684\u7236\u8282\u70b9\u8def\u5f84"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"path.getStatementParent();\n")),(0,l.kt)("h3",{id:"\u83b7\u53d6\u540c\u7ea7\u8def\u5f84"},(0,l.kt)("a",{id:"toc-get-sibling-paths"}),"\u83b7\u53d6\u540c\u7ea7\u8def\u5f84"),(0,l.kt)("p",null,"\u5982\u679c\u4e00\u4e2a\u8def\u5f84\u662f\u5728\u4e00\u4e2a ",(0,l.kt)("inlineCode",{parentName:"p"},"Function"),"\uff0f",(0,l.kt)("inlineCode",{parentName:"p"},"Program"),"\u4e2d\u7684\u5217\u8868\u91cc\u9762\uff0c\u5b83\u5c31\u6709\u540c\u7ea7\u8282\u70b9\u3002"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u4f7f\u7528",(0,l.kt)("inlineCode",{parentName:"li"},"path.inList"),"\u6765\u5224\u65ad\u8def\u5f84\u662f\u5426\u6709\u540c\u7ea7\u8282\u70b9\uff0c"),(0,l.kt)("li",{parentName:"ul"},"\u4f7f\u7528",(0,l.kt)("inlineCode",{parentName:"li"},"path.getSibling(index)"),"\u6765\u83b7\u5f97\u540c\u7ea7\u8def\u5f84,"),(0,l.kt)("li",{parentName:"ul"},"\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"li"},"path.key"),"\u83b7\u53d6\u8def\u5f84\u6240\u5728\u5bb9\u5668\u7684\u7d22\u5f15,"),(0,l.kt)("li",{parentName:"ul"},"\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"li"},"path.container"),"\u83b7\u53d6\u8def\u5f84\u7684\u5bb9\u5668\uff08\u5305\u542b\u6240\u6709\u540c\u7ea7\u8282\u70b9\u7684\u6570\u7ec4\uff09"),(0,l.kt)("li",{parentName:"ul"},"\u4f7f\u7528 ",(0,l.kt)("inlineCode",{parentName:"li"},"path.listKey"),"\u83b7\u53d6\u5bb9\u5668\u7684key")),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u8fd9\u4e9bAPI\u7528\u4e8e babel-minify\u4e2d\u4f7f\u7528\u7684 transform-merge-sibling-variables\u63d2\u4ef6."),(0,l.kt)("pre",{parentName:"blockquote"},(0,l.kt)("code",{parentName:"pre",className:"language-js"},"var a = 1; // pathA, path.key = 0\nvar b = 2; // pathB, path.key = 1\nvar c = 3; // pathC, path.key = 2\n"))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'export default function({ types: t }) {\n  return {\n    visitor: {\n      VariableDeclaration(path) {\n        // if the current path is pathA\n        path.inList // true\n        path.listKey // "body"\n        path.key // 0\n        path.getSibling(0) // pathA\n        path.getSibling(path.key + 1) // pathB\n        path.container // [pathA, pathB, pathC]\n      }\n    }\n  };\n}\n')),(0,l.kt)("h3",{id:"\u505c\u6b62\u904d\u5386"},(0,l.kt)("a",{id:"toc-stopping-traversal"}),"\u505c\u6b62\u904d\u5386"),(0,l.kt)("p",null,"\u5982\u679c\u4f60\u7684\u63d2\u4ef6\u9700\u8981\u5728\u67d0\u79cd\u60c5\u51b5\u4e0b\u4e0d\u8fd0\u884c\uff0c\u6700\u7b80\u5355\u7684\u505a\u6cd5\u662f\u5c3d\u65e9\u5199\u56de\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"BinaryExpression(path) {\n  if (path.node.operator !== '**') return;\n}\n")),(0,l.kt)("p",null,"\u5982\u679c\u60a8\u5728\u9876\u7ea7\u8def\u5f84\u4e2d\u8fdb\u884c\u5b50\u904d\u5386\uff0c\u5219\u53ef\u4ee5\u4f7f\u75282\u4e2a\u63d0\u4f9b\u7684API\u65b9\u6cd5\uff1a"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"path.skip()")," skips traversing the children of the current path. ",(0,l.kt)("inlineCode",{parentName:"p"},"path.stop()")," stops traversal entirely."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"outerPath.traverse({\n  Function(innerPath) {\n    innerPath.skip(); // if checking the children is irrelevant\n  },\n  ReferencedIdentifier(innerPath, state) {\n    state.iife = true;\n    innerPath.stop(); // if you want to save some state and then stop traversal, or deopt\n  }\n});\n")),(0,l.kt)("h2",{id:"\u5904\u7406"},(0,l.kt)("a",{id:"toc-manipulation"}),"\u5904\u7406"),(0,l.kt)("h3",{id:"\u66ff\u6362\u4e00\u4e2a\u8282\u70b9"},(0,l.kt)("a",{id:"toc-replacing-a-node"}),"\u66ff\u6362\u4e00\u4e2a\u8282\u70b9"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'BinaryExpression(path) {\n  path.replaceWith(\n    t.binaryExpression("**", path.node.left, t.numberLiteral(2))\n  );\n}\n')),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-diff"},"  function square(n) {\n-   return n * n;\n+   return n ** 2;\n  }\n")),(0,l.kt)("h3",{id:"\u7528\u591a\u8282\u70b9\u66ff\u6362\u5355\u8282\u70b9"},(0,l.kt)("a",{id:"toc-replacing-a-node-with-multiple-nodes"}),"\u7528\u591a\u8282\u70b9\u66ff\u6362\u5355\u8282\u70b9"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'ReturnStatement(path) {\n  path.replaceWithMultiple([\n    t.expressionStatement(t.stringLiteral("Is this the real life?")),\n    t.expressionStatement(t.stringLiteral("Is this just fantasy?")),\n    t.expressionStatement(t.stringLiteral("(Enjoy singing the rest of the song in your head)")),\n  ]);\n}\n')),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-diff"},'  function square(n) {\n-   return n * n;\n+   "Is this the real life?";\n+   "Is this just fantasy?";\n+   "(Enjoy singing the rest of the song in your head)";\n  }\n')),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"**\u6ce8\u610f\uff1a\u5f53\u7528\u591a\u4e2a\u8282\u70b9\u66ff\u6362\u4e00\u4e2a\u8868\u8fbe\u5f0f\u65f6\uff0c\u5b83\u4eec\u5fc5\u987b\u662f \xa0\xa0\u58f0\u660e\u3002 \u8fd9\u662f\u56e0\u4e3aBabel\u5728\u66f4\u6362\u8282\u70b9\u65f6\u5e7f\u6cdb\u4f7f\u7528\u542f\u53d1\u5f0f\u7b97\u6cd5\uff0c\u8fd9\u610f\u5473\u7740\u60a8\u53ef\u4ee5\u505a\u4e00\u4e9b\u975e\u5e38\u75af\u72c2\u7684\u8f6c\u6362\uff0c\u5426\u5219\u5c06\u4f1a\u975e\u5e38\u5197\u957f\u3002")),(0,l.kt)("blockquote",null,(0,l.kt)("h3",{parentName:"blockquote",id:"\u7528\u5b57\u7b26\u4e32\u6e90\u7801\u66ff\u6362\u8282\u70b9"},(0,l.kt)("a",{id:"toc-replacing-a-node-with-a-source-string"}),"\u7528\u5b57\u7b26\u4e32\u6e90\u7801\u66ff\u6362\u8282\u70b9"),(0,l.kt)("pre",{parentName:"blockquote"},(0,l.kt)("code",{parentName:"pre",className:"language-js"},"FunctionDeclaration(path) {\n path.replaceWithSourceString(`function add(a, b) {\n   return a + b;\n }`);\n}\n"))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-diff"},"- function square(n) {\n-   return n * n;\n+ function add(a, b) {\n+   return a + b;\n  }\n")),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"**\u6ce8\u610f\uff1a\u4e0d\u5efa\u8bae\u4f7f\u7528\u8fd9\u4e2aAPI\uff0c\u9664\u975e\u60a8\u6b63\u5728\u5904\u7406\u52a8\u6001\u7684\u6e90\u7801\u5b57\u7b26\u4e32\uff0c\u5426\u5219\u5728\u8bbf\u95ee\u8005\u5916\u90e8\u89e3\u6790\u4ee3\u7801\u66f4\u6709\u6548\u7387\u3002"),(0,l.kt)("h3",{parentName:"blockquote",id:"\u63d2\u5165\u5144\u5f1f\u8282\u70b9"},(0,l.kt)("a",{id:"toc-inserting-a-sibling-node"}),"\u63d2\u5165\u5144\u5f1f\u8282\u70b9"),(0,l.kt)("pre",{parentName:"blockquote"},(0,l.kt)("code",{parentName:"pre",className:"language-js"},'FunctionDeclaration(path) {\n  path.insertBefore(t.expressionStatement(t.stringLiteral("Because I\'m easy come, easy go.")));\n  path.insertAfter(t.expressionStatement(t.stringLiteral("A little high, little low.")));\n}\n'))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-diff"},'+ "Because I\'m easy come, easy go.";\n  function square(n) {\n    return n * n;\n  }\n+ "A little high, little low.";\n')),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u6ce8\u610f\uff1a\u8fd9\u91cc\u540c\u6837\u5e94\u8be5\u4f7f\u7528\u58f0\u660e\u6216\u8005\u4e00\u4e2a\u58f0\u660e\u6570\u7ec4\u3002 \u8fd9\u4e2a\u4f7f\u7528\u4e86\u5728\u7528\u591a\u4e2a\u8282\u70b9\u66ff\u6362\u4e00\u4e2a\u8282\u70b9\u4e2d\u63d0\u5230\u7684\u76f8\u540c\u7684\u542f\u53d1\u5f0f\u7b97\u6cd5\u3002."),(0,l.kt)("h3",{parentName:"blockquote",id:"\u63d2\u5165\u5230\u5bb9\u5668container\u4e2d"},(0,l.kt)("a",{id:"toc-inserting-into-a-container"}),"\u63d2\u5165\u5230\u5bb9\u5668\uff08container\uff09\u4e2d"),(0,l.kt)("p",{parentName:"blockquote"},"\u5982\u679c\u60a8\u60f3\u8981\u5728AST\u8282\u70b9\u5c5e\u6027\u4e2d\u63d2\u5165\u4e00\u4e2a\u50cf",(0,l.kt)("inlineCode",{parentName:"p"},"body </ 0>\u90a3\u6837\u7684\u6570\u7ec4\u3002\n\u5b83\u4e0e insertBefore"),"/",(0,l.kt)("inlineCode",{parentName:"p"},"insertAfter")," \u7c7b\u4f3c, \u4f46\u60a8\u5fc5\u987b\u6307\u5b9a ",(0,l.kt)("inlineCode",{parentName:"p"},"listKey")," (\u901a\u5e38\u662f ",(0,l.kt)("inlineCode",{parentName:"p"},"\u6b63\u6587"),").")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"ClassMethod(path) {\n path.get('body').unshiftContainer('body', t.expressionStatement(t.stringLiteral('before')));\n path.get('body').pushContainer('body', t.expressionStatement(t.stringLiteral('after')));\n}\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-diff"},' class A {\n  constructor() {\n+   "before"\n    var a = \'middle\';\n+   "after"\n  }\n }\n')),(0,l.kt)("h3",{id:"\u5220\u9664\u4e00\u4e2a\u8282\u70b9"},(0,l.kt)("a",{id:"toc-removing-a-node"}),"\u5220\u9664\u4e00\u4e2a\u8282\u70b9"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"FunctionDeclaration(path) {\n  path.remove();\n}\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-diff"},"- function square(n) {\n-   return n * n;\n- }\n")),(0,l.kt)("h3",{id:"\u66ff\u6362\u7236\u8282\u70b9"},(0,l.kt)("a",{id:"toc-replacing-a-parent"}),"\u66ff\u6362\u7236\u8282\u70b9"),(0,l.kt)("p",null,"\u53ea\u9700\u4f7f\u7528parentPath\uff1a` path.parentPath \u8c03\u7528 replaceWith \u5373\u53ef"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'BinaryExpression(path) {\n  path.parentPath.replaceWith(\n    t.expressionStatement(t.stringLiteral("Anyway the wind blows, doesn\'t really matter to me, to me."))\n  )\n}\n')),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-diff"},'  function square(n) {\n-   return n * n;\n+   "Anyway the wind blows, doesn\'t really matter to me, to me.";\n  }\n')),(0,l.kt)("h3",{id:"\u5220\u9664\u7236\u8282\u70b9"},(0,l.kt)("a",{id:"toc-removing-a-parent"}),"\u5220\u9664\u7236\u8282\u70b9"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"BinaryExpression(path) {\n  path.parentPath.remove();\n}\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-diff"},"  function square(n) {\n-   return n * n;\n  }\n")),(0,l.kt)("h2",{id:"scope\u4f5c\u7528\u57df"},(0,l.kt)("a",{id:"toc-scope"}),"Scope\uff08\u4f5c\u7528\u57df\uff09"),(0,l.kt)("h3",{id:"\u68c0\u67e5\u672c\u5730\u53d8\u91cf\u662f\u5426\u88ab\u7ed1\u5b9a"},(0,l.kt)("a",{id:"toc-checking-if-a-local-variable-is-bound"}),"\u68c0\u67e5\u672c\u5730\u53d8\u91cf\u662f\u5426\u88ab\u7ed1\u5b9a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'FunctionDeclaration(path) {\n  if (path.scope.hasBinding("n")) {\n    // ...\n  }\n}\n')),(0,l.kt)("p",null,"\u8fd9\u5c06\u904d\u5386\u8303\u56f4\u6811\u5e76\u68c0\u67e5\u7279\u5b9a\u7684\u7ed1\u5b9a\u3002"),(0,l.kt)("p",null,"\u60a8\u4e5f\u53ef\u4ee5\u68c0\u67e5\u4e00\u4e2a\u4f5c\u7528\u57df\u662f\u5426\u6709**\u81ea\u5df1\u7684\u7ed1\u5b9a\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'FunctionDeclaration(path) {\n  if (path.scope.hasOwnBinding("n")) {\n    // ...\n  }\n}\n')),(0,l.kt)("h3",{id:"\u521b\u5efa\u4e00\u4e2a-uid"},(0,l.kt)("a",{id:"toc-generating-a-uid"}),"\u521b\u5efa\u4e00\u4e2a UID"),(0,l.kt)("p",null,"\u8fd9\u5c06\u751f\u6210\u4e00\u4e2a\u6807\u8bc6\u7b26\uff0c\u4e0d\u4f1a\u4e0e\u4efb\u4f55\u672c\u5730\u5b9a\u4e49\u7684\u53d8\u91cf\u76f8\u51b2\u7a81\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'FunctionDeclaration(path) {\n  path.scope.generateUidIdentifier("uid");\n  // Node { type: "Identifier", name: "_uid" }\n  path.scope.generateUidIdentifier("uid");\n  // Node { type: "Identifier", name: "_uid2" }\n}\n')),(0,l.kt)("h3",{id:"\u63d0\u5347\u53d8\u91cf\u58f0\u660e\u81f3\u7236\u7ea7\u4f5c\u7528\u57df"},(0,l.kt)("a",{id:"toc-pushing-a-variable-declaration-to-a-parent-scope"}),"\u63d0\u5347\u53d8\u91cf\u58f0\u660e\u81f3\u7236\u7ea7\u4f5c\u7528\u57df"),(0,l.kt)("p",null,"\u6709\u65f6\u4f60\u53ef\u80fd\u60f3\u8981\u63a8\u9001\u4e00\u4e2a VariableDeclaration \uff0c\u8fd9\u6837\u4f60\u5c31\u53ef\u4ee5\u5206\u914d\u7ed9\u5b83\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"FunctionDeclaration(path) {\n  const id = path.scope.generateUidIdentifierBasedOnNode(path.node.id);\n  path.remove();\n  path.scope.parent.push({ id, init: path.node });\n}\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-diff"},"- function square(n) {\n+ var _square = function square(n) {\n    return n * n;\n- }\n+ };\n")),(0,l.kt)("h3",{id:"\u91cd\u547d\u540d\u7ed1\u5b9a\u53ca\u5176\u5f15\u7528"},(0,l.kt)("a",{id:"toc-rename-a-binding-and-its-references"}),"\u91cd\u547d\u540d\u7ed1\u5b9a\u53ca\u5176\u5f15\u7528"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'FunctionDeclaration(path) {\n  path.scope.rename("n", "x");\n}\n')),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-diff"},"- function square(n) {\n-   return n * n;\n+ function square(x) {\n+   return x * x;\n  }\n")),(0,l.kt)("p",null,"\u6216\u8005\uff0c\u60a8\u53ef\u4ee5\u5c06\u7ed1\u5b9a\u91cd\u547d\u540d\u4e3a\u751f\u6210\u7684\u552f\u4e00\u6807\u8bc6\u7b26\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'FunctionDeclaration(path) {\n  path.scope.rename("n");\n}\n')),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-diff"},"- function square(n) {\n-   return n * n;\n+ function square(_n) {\n+   return _n * _n;\n  }\n")),(0,l.kt)("hr",null),(0,l.kt)("h1",{id:"\u63d2\u4ef6\u9009\u9879"},(0,l.kt)("a",{id:"toc-plugin-options"}),"\u63d2\u4ef6\u9009\u9879"),(0,l.kt)("p",null,"\u5982\u679c\u60a8\u60f3\u8ba9\u60a8\u7684\u7528\u6237\u81ea\u5b9a\u4e49\u60a8\u7684Babel\u63d2\u4ef6\u7684\u884c\u4e3a\u60a8\u53ef\u4ee5\u63a5\u53d7\u7528\u6237\u53ef\u4ee5\u6307\u5b9a\u7684\u63d2\u4ef6\u7279\u5b9a\u9009\u9879\uff0c\u5982\u4e0b\u6240\u793a\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'{\n  plugins: [\n    ["my-plugin", {\n      "option1": true,\n      "option2": false\n    }]\n  ]\n}\n')),(0,l.kt)("p",null,"\u8fd9\u4e9b\u9009\u9879\u4f1a\u901a\u8fc7\u72b6\u6001\u5bf9\u8c61\u4f20\u9012\u7ed9\u63d2\u4ef6\u8bbf\u95ee\u8005\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"export default function({ types: t }) {\n  return {\n    visitor: {\n      FunctionDeclaration(path, state) {\n        console.log(state.opts);\n        // { option1: true, option2: false }\n      }\n    }\n  }\n}\n")),(0,l.kt)("p",null,"\u8fd9\u4e9b\u9009\u9879\u662f\u7279\u5b9a\u4e8e\u63d2\u4ef6\u7684\uff0c\u60a8\u4e0d\u80fd\u8bbf\u95ee\u5176\u4ed6\u63d2\u4ef6\u4e2d\u7684\u9009\u9879\u3002"),(0,l.kt)("h2",{id:"-\u63d2\u4ef6\u7684\u51c6\u5907\u548c\u6536\u5c3e\u5de5\u4f5c"},(0,l.kt)("a",{id:"toc-pre-and-post-in-plugins"})," \u63d2\u4ef6\u7684\u51c6\u5907\u548c\u6536\u5c3e\u5de5\u4f5c"),(0,l.kt)("p",null,"\u63d2\u4ef6\u53ef\u4ee5\u5177\u6709\u5728\u63d2\u4ef6\u4e4b\u524d\u6216\u4e4b\u540e\u8fd0\u884c\u7684\u51fd\u6570\u3002\u5b83\u4eec\u53ef\u4ee5\u7528\u4e8e\u8bbe\u7f6e\u6216\u6e05\u7406/\u5206\u6790\u76ee\u7684\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"export default function({ types: t }) {\n  return {\n    pre(state) {\n      this.cache = new Map();\n    },\n    visitor: {\n      StringLiteral(path) {\n        this.cache.set(path.node.value, 1);\n      }\n    },\n    post(state) {\n      console.log(this.cache);\n    }\n  };\n}\n")),(0,l.kt)("h2",{id:"-\u5728\u63d2\u4ef6\u4e2d\u542f\u7528\u5176\u4ed6\u8bed\u6cd5"},(0,l.kt)("a",{id:"toc-enabling-syntax-in-plugins"})," \u5728\u63d2\u4ef6\u4e2d\u542f\u7528\u5176\u4ed6\u8bed\u6cd5"),(0,l.kt)("p",null,"\u63d2\u4ef6\u53ef\u4ee5\u542f\u7528babylon plugins\uff0c\u4ee5\u4fbf\u7528\u6237\u4e0d\u9700\u8981\u5b89\u88c5/\u542f\u7528\u5b83\u4eec\u3002 \u8fd9\u53ef\u4ee5\u9632\u6b62\u89e3\u6790\u9519\u8bef\uff0c\u800c\u4e0d\u4f1a\u7ee7\u627f\u8bed\u6cd5\u63d2\u4ef6\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'export default function({ types: t }) {\n  return {\n    inherits: require("babel-plugin-syntax-jsx")\n  };\n}\n')),(0,l.kt)("h2",{id:"-\u629b\u51fa\u4e00\u4e2a\u8bed\u6cd5\u9519\u8bef"},(0,l.kt)("a",{id:"toc-throwing-a-syntax-error"})," \u629b\u51fa\u4e00\u4e2a\u8bed\u6cd5\u9519\u8bef"),(0,l.kt)("p",null,"\u5982\u679c\u60a8\u60f3\u7528babel-code-frame\u548c\u4e00\u4e2a\u6d88\u606f\u629b\u51fa\u4e00\u4e2a\u9519\u8bef\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'export default function({ types: t }) {\n  return {\n    visitor: {\n      StringLiteral(path) {\n        throw path.buildCodeFrameError("Error message here");\n      }\n    }\n  };\n}\n')),(0,l.kt)("p",null,"\u8be5\u9519\u8bef\u770b\u8d77\u6765\u50cf\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'file.js: Error message here\n   7 |\n   8 | let tips = [\n>  9 |   "Click on any AST node with a \'+\' to expand it",\n     |   ^\n  10 |\n  11 |   "Hovering over a node highlights the \\\n  12 |    corresponding part in the source code",\n')),(0,l.kt)("hr",null),(0,l.kt)("h1",{id:"\u6784\u5efa\u8282\u70b9"},(0,l.kt)("a",{id:"toc-building-nodes"}),"\u6784\u5efa\u8282\u70b9"),(0,l.kt)("p",null,"\u7f16\u5199\u8f6c\u6362\u65f6\uff0c\u901a\u5e38\u9700\u8981\u6784\u5efa\u4e00\u4e9b\u8981\u63d2\u5165\u7684\u8282\u70b9\u8fdb\u5165AST\u3002 \u5982\u524d\u6240\u8ff0\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528` babel-types \u5305\u4e2d\u7684builder \u65b9\u6cd5\u3002"),(0,l.kt)("p",null,"\u6784\u5efa\u5668\u7684\u65b9\u6cd5\u540d\u79f0\u5c31\u662f\u60a8\u60f3\u8981\u7684\u8282\u70b9\u7c7b\u578b\u7684\u540d\u79f0\uff0c\u9664\u4e86\u7b2c\u4e00\u4e2a\u5b57\u6bcd\u5c0f\u5199\u3002 \u4f8b\u5982\uff0c\u5982\u679c\u60a8\u60f3\u5efa\u7acb\u4e00\u4e2a MemberExpression \u60a8\u53ef\u4ee5\u4f7f\u7528 t.memberExpression\uff08...\uff09",(0,l.kt)("p",null,"\u8fd9\u4e9b\u6784\u5efa\u5668\u7684\u53c2\u6570\u7531\u8282\u70b9\u5b9a\u4e49\u51b3\u5b9a\u3002 \u6709\u4e00\u4e9b\u6b63\u5728\u505a\u7684\u5de5\u4f5c\uff0c\u4ee5\u751f\u6210\u6613\u4e8e\u9605\u8bfb\u7684\u6587\u4ef6\u5b9a\u4e49\uff0c\u4f46\u73b0\u5728\u4ed6\u4eec\u90fd\u53ef\u4ee5\u5728",(0,l.kt)("a",{href:"https://github.com/babel/babel/tree/master/packages/babel-types/src/definitions"},"\u6b64\u5904"),"\u627e\u5230\u3002."),(0,l.kt)("p",null,"\u8282\u70b9\u5b9a\u4e49\u5982\u4e0b\u6240\u793a\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'defineType("MemberExpression", {\n  builder: ["object", "property", "computed"],\n  visitor: ["object", "property"],\n  aliases: ["Expression", "LVal"],\n  fields: {\n    object: {\n      validate: assertNodeType("Expression")\n    },\n    property: {\n      validate(node, key, val) {\n        let expectedType = node.computed ? "Expression" : "Identifier";\n        assertNodeType(expectedType)(node, key, val);\n      }\n    },\n    computed: {\n      default: false\n    }\n  }\n});\n')),(0,l.kt)("p",null,"\u5728\u8fd9\u91cc\u4f60\u53ef\u4ee5\u770b\u5230\u5173\u4e8e\u8fd9\u4e2a\u7279\u5b9a\u8282\u70b9\u7c7b\u578b\u7684\u6240\u6709\u4fe1\u606f\uff0c\u5305\u62ec\u5982\u4f55\u6784\u5efa\u5b83\uff0c\u904d\u5386\u5b83\uff0c\u5e76\u9a8c\u8bc1\u5b83\u3002"),(0,l.kt)("p",null,"\u901a\u8fc7\u67e5\u770b ",(0,l.kt)("inlineCode",{parentName:"p"},"\u751f\u6210\u5668")," \u5c5e\u6027, \u53ef\u4ee5\u770b\u5230\u8c03\u7528\u751f\u6210\u5668\u65b9\u6cd5\u6240\u9700\u76843\u4e2a\u53c2\u6570 (",(0,l.kt)("inlineCode",{parentName:"p"},"t. \u60c5\u51b5"),")."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'\u751f\u6210\u5668: ["object", "property", "computed"],\n')),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"\u8bf7\u6ce8\u610f\uff0c\u6709\u65f6\u5728\u8282\u70b9\u4e0a\u53ef\u4ee5\u5b9a\u5236\u7684\u5c5e\u6027\u6bd4``\u6784\u5efa\u5668 \u6570\u7ec4\u5305\u542b\u7684\u5c5e\u6027\u66f4\u591a\u3002 \u8fd9\u662f\u4e3a\u4e86\u9632\u6b62\u751f\u6210\u5668\u6709\u592a\u591a\u7684\u53c2\u6570\u3002 \u5728\u8fd9\u4e9b\u60c5\u51b5\u4e0b\uff0c\u60a8\u9700\u8981\u624b\u52a8\u8bbe\u7f6e\u5c5e\u6027\u3002 \u4e00\u4e2a\u4f8b\u5b50\u662f  ClassMethod ")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js",metastring:"// Example","//":!0,Example:!0},'// because the builder doesn\'t contain `async` as a property\nvar node = t.classMethod(\n  "constructor",\n  t.identifier("constructor"),\n  params,\n  body\n)\n// set it manually after creation\nnode.async = true;\n')),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"You can see the validation for the builder arguments with the ",(0,l.kt)("inlineCode",{parentName:"p"},"fields")," object.")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'fields: {\n  object: {\n    validate: assertNodeType("Expression")\n  },\n  property: {\n    validate(node, key, val) {\n      let expectedType = node.computed ? "Expression" : "Identifier";\n      assertNodeType(expectedType)(node, key, val);\n    }\n  },\n  computed: {\n    default: false\n  }\n}\n')),(0,l.kt)("p",null,"You can see that ",(0,l.kt)("inlineCode",{parentName:"p"},"object")," needs to be an ",(0,l.kt)("inlineCode",{parentName:"p"},"Expression"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"property")," either needs to be an ",(0,l.kt)("inlineCode",{parentName:"p"},"Expression")," or an ",(0,l.kt)("inlineCode",{parentName:"p"},"Identifier")," depending on if the member expression is ",(0,l.kt)("inlineCode",{parentName:"p"},"computed")," or not and ",(0,l.kt)("inlineCode",{parentName:"p"},"computed")," is simply a boolean that defaults to ",(0,l.kt)("inlineCode",{parentName:"p"},"false"),"."),(0,l.kt)("p",null,"So we can construct a ",(0,l.kt)("inlineCode",{parentName:"p"},"MemberExpression")," by doing the following:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"t.memberExpression(\n  t.identifier('object'),\n  t.identifier('property')\n  // `computed` is optional\n);\n")),(0,l.kt)("p",null,"Which will result in:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"object.property\n")),(0,l.kt)("p",null,"However, we said that ",(0,l.kt)("inlineCode",{parentName:"p"},"object")," needed to be an ",(0,l.kt)("inlineCode",{parentName:"p"},"Expression")," so why is ",(0,l.kt)("inlineCode",{parentName:"p"},"Identifier")," valid?"),(0,l.kt)("p",null,"Well if we look at the definition of ",(0,l.kt)("inlineCode",{parentName:"p"},"Identifier")," we can see that it has an ",(0,l.kt)("inlineCode",{parentName:"p"},"aliases")," property which states that it is also an expression."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'aliases: ["Expression", "LVal"],\n')),(0,l.kt)("p",null,"So since ",(0,l.kt)("inlineCode",{parentName:"p"},"MemberExpression")," is a type of ",(0,l.kt)("inlineCode",{parentName:"p"},"Expression"),", we could set it as the ",(0,l.kt)("inlineCode",{parentName:"p"},"object")," of another ",(0,l.kt)("inlineCode",{parentName:"p"},"MemberExpression"),":"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"t.memberExpression(\n  t.memberExpression(\n    t.identifier('member'),\n    t.identifier('expression')\n  ),\n  t.identifier('property')\n)\n")),(0,l.kt)("p",null,"Which will result in:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"member.expression.property\n")),(0,l.kt)("p",null,"It's very unlikely that you will ever memorize the builder method signatures for every node type. So you should take some time and understand how they are generated from the node definitions."),(0,l.kt)("p",null,"You can find all of the actual ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/babel/babel/tree/master/packages/babel-types/src/definitions"},"definitions here")," and you can see them ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/babel/babel/blob/master/doc/ast/spec.md"},"documented here")),(0,l.kt)("hr",null),(0,l.kt)("h1",{id:"\u6700\u4f73\u5b9e\u8df5"},(0,l.kt)("a",{id:"toc-best-practices"}),"\u6700\u4f73\u5b9e\u8df5"),(0,l.kt)("h2",{id:"-create-helper-builders-and-checkers"},(0,l.kt)("a",{id:"toc-create-helper-builders-and-checkers"})," Create Helper Builders and Checkers"),(0,l.kt)("p",null,"It's pretty simple to extract certain checks (if a node is a certain type) into their own helper functions as well as extracting out helpers for specific node types."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'function isAssignment(node) {\n  return node && node.operator === opts.operator + "=";\n}\n\nfunction buildAssignment(left, right) {\n  return t.assignmentExpression("=", left, right);\n}\n')),(0,l.kt)("h2",{id:"\u5c3d\u91cf\u907f\u514d\u904d\u5386\u62bd\u8c61\u8bed\u6cd5\u6811ast"},(0,l.kt)("a",{id:"toc-avoid-traversing-the-ast-as-much-as-possible"}),"\u5c3d\u91cf\u907f\u514d\u904d\u5386\u62bd\u8c61\u8bed\u6cd5\u6811\uff08AST\uff09"),(0,l.kt)("p",null,"Traversing the AST is expensive, and it's easy to accidentally traverse the AST more than necessary. This could be thousands if not tens of thousands of extra operations."),(0,l.kt)("p",null,"Babel optimizes this as much as possible, merging visitors together if it can in order to do everything in a single traversal."),(0,l.kt)("h3",{id:"\u53ca\u65f6\u5408\u5e76\u8bbf\u95ee\u8005\u5bf9\u8c61"},(0,l.kt)("a",{id:"toc-merge-visitors-whenever-possible"}),"\u53ca\u65f6\u5408\u5e76\u8bbf\u95ee\u8005\u5bf9\u8c61"),(0,l.kt)("p",null,"When writing visitors, it may be tempting to call ",(0,l.kt)("inlineCode",{parentName:"p"},"path.traverse")," in multiple places where they are logically necessary."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"path.traverse({\n  Identifier(path) {\n    // ...\n  }\n});\n\npath.traverse({\n  BinaryExpression(path) {\n    // ...\n  }\n});\n")),(0,l.kt)("p",null,"However, it is far better to write these as a single visitor that only gets run once. Otherwise you are traversing the same tree multiple times for no reason."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"path.traverse({\n  Identifier(path) {\n    // ...\n  },\n  BinaryExpression(path) {\n    // ...\n  }\n});\n")),(0,l.kt)("h3",{id:"\u53ef\u4ee5\u624b\u52a8\u67e5\u627e\u5c31\u4e0d\u8981\u904d\u5386"},(0,l.kt)("a",{id:"toc-do-not-traverse-when-manual-lookup-will-do"}),"\u53ef\u4ee5\u624b\u52a8\u67e5\u627e\u5c31\u4e0d\u8981\u904d\u5386"),(0,l.kt)("p",null,"It may also be tempting to call ",(0,l.kt)("inlineCode",{parentName:"p"},"path.traverse")," when looking for a particular node type."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"const nestedVisitor = {\n  Identifier(path) {\n    // ...\n  }\n};\n\nconst MyVisitor = {\n  FunctionDeclaration(path) {\n    path.get('params').traverse(nestedVisitor);\n  }\n};\n")),(0,l.kt)("p",null,"However, if you are looking for something specific and shallow, there is a good chance you can manually lookup the nodes you need without performing a costly traversal."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"const MyVisitor = {\n  FunctionDeclaration(path) {\n    path.node.params.forEach(function() {\n      // ...\n    });\n  }\n};\n")),(0,l.kt)("h2",{id:"\u4f18\u5316\u5d4c\u5957\u7684\u8bbf\u95ee\u8005\u5bf9\u8c61"},(0,l.kt)("a",{id:"toc-optimizing-nested-visitors"}),"\u4f18\u5316\u5d4c\u5957\u7684\u8bbf\u95ee\u8005\u5bf9\u8c61"),(0,l.kt)("p",null,"\u5f53\u60a8\u5d4c\u5957\u8bbf\u95ee\u8005\uff08visitor\uff09\u65f6\uff0c\u628a\u5b83\u4eec\u5d4c\u5957\u5728\u60a8\u7684\u4ee3\u7801\u4e2d\u53ef\u80fd\u662f\u6709\u610f\u4e49\u7684\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"const MyVisitor = {\n  FunctionDeclaration(path) {\n    path.traverse({\n      Identifier(path) {\n        // ...\n      }\n    });\n  }\n};\n")),(0,l.kt)("p",null,"\u4f46\u662f\uff0c\u6bcf\u5f53\u8c03\u7528`FunctionDeclaration()\u65f6\u90fd\u4f1a\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u8bbf\u95ee\u8005\u5bf9\u8c61\u3002 That can be costly, because Babel does some processing each time a new\nvisitor object is passed in (such as exploding keys containing multiple types,\nperforming validation, and adjusting the object structure). Because Babel stores\nflags on visitor objects indicating that it's already performed that processing,\nit's better to store the visitor in a variable and pass the same object each\ntime.")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"const nestedVisitor = {\n  Identifier(path) {\n    // ...\n  }\n};\n\nconst MyVisitor = {\n  FunctionDeclaration(path) {\n    path.traverse(nestedVisitor);\n  }\n};\n")),(0,l.kt)("p",null,"\u5982\u679c\u60a8\u5728\u5d4c\u5957\u7684\u8bbf\u95ee\u8005\u4e2d\u9700\u8981\u4e00\u4e9b\u72b6\u6001\uff0c\u50cf\u8fd9\u6837\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"const MyVisitor = {\n  FunctionDeclaration(path) {\n    var exampleState = path.node.params[0].name;\n\n    path.traverse({\n      Identifier(path) {\n        if (path.node.name === exampleState) {\n          // ...\n        }\n      }\n    });\n  }\n};\n")),(0,l.kt)("p",null,"\u60a8\u53ef\u4ee5\u5c06\u5b83\u4f5c\u4e3a\u72b6\u6001\u4f20\u9012\u7ed9",(0,l.kt)("inlineCode",{parentName:"p"},"traverse()</ 0>\u65b9\u6cd5\uff0c\u5e76\u6709\u6743\u8bbf\u95ee<code>this"),"\u5728\u8bbf\u95ee\u8005\u4e2d\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"const nestedVisitor = {\n  Identifier(path) {\n    if (path.node.name === this.exampleState) {\n      // ...\n    }\n  }\n};\n\nconst MyVisitor = {\n  FunctionDeclaration(path) {\n    var exampleState = path.node.params[0].name;\n    path.traverse(nestedVisitor, { exampleState });\n  }\n};\n")),(0,l.kt)("h2",{id:"\u7559\u610f\u5d4c\u5957\u7ed3\u6784"},(0,l.kt)("a",{id:"toc-being-aware-of-nested-structures"}),"\u7559\u610f\u5d4c\u5957\u7ed3\u6784"),(0,l.kt)("p",null,"\u6709\u65f6\u5019\u5728\u8003\u8651\u7ed9\u5b9a\u7684\u8f6c\u6362\u65f6\uff0c\u53ef\u80fd\u4f1a\u5fd8\u8bb0\u7ed9\u5b9a\u7684\u8f6c\u6362\u7ed3\u6784\u53ef\u4ee5\u662f\u5d4c\u5957\u7684\u3002"),(0,l.kt)("p",null,"\u4f8b\u5982\uff0c\u60f3\u8c61\u4e00\u4e0b\uff0c\u6211\u4eec\u60f3\u8981\u67e5\u627e",(0,l.kt)("inlineCode",{parentName:"p"},"\u6784\u9020\u51fd\u6570")," ",(0,l.kt)("inlineCode",{parentName:"p"},"ClassMethod")," ",(0,l.kt)("inlineCode",{parentName:"p"},"Foo")," ",(0,l.kt)("inlineCode",{parentName:"p"},"ClassDeclaration"),"."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"class Foo {\n  constructor() {\n    // ...\n  }\n}\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"const constructorVisitor = {\n  ClassMethod(path) {\n    if (path.node.name === 'constructor') {\n      // ...\n    }\n  }\n}\n\nconst MyVisitor = {\n  ClassDeclaration(path) {\n    if (path.node.id.name === 'Foo') {\n      path.traverse(constructorVisitor);\n    }\n  }\n}\n")),(0,l.kt)("p",null,"\u6211\u4eec\u5ffd\u7565\u4e86\u7c7b\u53ef\u4ee5\u5d4c\u5957\u7684\u4e8b\u5b9e\uff0c\u4f7f\u7528\u904d\u5386\u7684\u8bdd\uff0c\u4e0a\u9762\u6211\u4eec\u4e5f\u4f1a\u5f97\u5230\u4e00\u4e2a\u5d4c\u5957\u7684`\u6784\u9020\u51fd\u6570"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"class Foo {\n  constructor() {\n    class Bar {\n      constructor() {\n        // ...\n      }\n    }\n  }\n}\n")),(0,l.kt)("h2",{id:"\u5355\u5143\u6d4b\u8bd5"},(0,l.kt)("a",{id:"toc-unit-testing"}),"\u5355\u5143\u6d4b\u8bd5"),(0,l.kt)("p",null,"\u6709\u51e0\u79cd\u4e3b\u8981\u7684\u65b9\u6cd5\u6765\u6d4b\u8bd5babel\u63d2\u4ef6\uff1a\u5feb\u7167\u6d4b\u8bd5\uff0cAST\u6d4b\u8bd5\u548c\u6267\u884c\u6d4b\u8bd5\u3002 \u5bf9\u4e8e\u8fd9\u4e2a\u4f8b\u5b50\uff0c\u6211\u4eec\u5c06\u4f7f\u7528 jest\uff0c\u56e0\u4e3a\u5b83\u652f\u6301\u76d2\u5916\u5feb\u7167\u6d4b\u8bd5\u3002 \u6211\u4eec\u5728\u8fd9\u91cc\u521b\u5efa\u7684\u793a\u4f8b\u662f\u6258\u7ba1\u5728\u8fd9\u4e2a repo"),(0,l.kt)("p",null,"\u9996\u5148\u6211\u4eec\u9700\u8981\u4e00\u4e2ababel\u63d2\u4ef6\uff0c\u6211\u4eec\u5c06\u628a\u5b83\u653e\u5728src / index.js\u4e2d\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"<br />module.exports = function testPlugin(babel) {\n  return {\n    visitor: {\n      Identifier(path) {\n        if (path.node.name === 'foo') {\n          path.node.name = 'bar';\n        }\n      }\n    }\n  };\n};\n")),(0,l.kt)("h3",{id:"\u5feb\u7167\u6d4b\u8bd5"},"\u5feb\u7167\u6d4b\u8bd5"),(0,l.kt)("p",null,"\u63a5\u4e0b\u6765\uff0c\u7528`` npm install --save-dev babel-core jest \u5b89\u88c5\u6211\u4eec\u7684\u4f9d\u8d56\u5173\u7cfb\uff0c\n\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u5f00\u59cb\u5199\u6211\u4eec\u7684\u7b2c\u4e00\u4e2a\u6d4b\u8bd5\uff1a\u5feb\u7167\u3002 \u5feb\u7167\u6d4b\u8bd5\u5141\u8bb8\u6211\u4eec\u76f4\u89c2\u5730\u68c0\u67e5\u6211\u4eec\u7684babel\u63d2\u4ef6\u7684\u8f93\u51fa\u3002 \u6211\u4eec\u7ed9\u5b83\u4e00\u4e2a\u8f93\u5165\uff0c\u544a\u8bc9\u5b83\u4e00\u4e2a\u5feb\u7167\uff0c\u5e76\u5c06\u5176\u4fdd\u5b58\u5230\u4e00\u4e2a\u6587\u4ef6\u3002 \u6211\u4eec\u68c0\u67e5\u5feb\u7167\u5230git\u4e2d\u3002 \u8fd9\u5141\u8bb8\u6211\u4eec\u6765\u770b\u770b\u6211\u4eec\u4ec0\u4e48\u65f6\u5019\u5f71\u54cd\u4e86\u6211\u4eec\u4efb\u4f55\u8bd5\u7528\u4f8b\u5b50\u6d4b\u8bd5\u7684\u8f93\u51fa\u3002 \u5b83\u4e5f\u7ed9\u51fa\u4e86\u4f7f\u7528\u5dee\u5f02\u5728\u62c9\u8bf7\u6c42\u7684\u65f6\u5019\u3002 \u5f53\u7136\uff0c\u60a8\u53ef\u4ee5\u7528\u4efb\u4f55\u6d4b\u8bd5\u6846\u67b6\u6765\u505a\u5230\u8fd9\u4e00\u70b9\uff0c\u4f46\u662f\u8981\u66f4\u65b0\u4e00\u4e0b\u5feb\u7167\u5c31\u50cfjest -u\u4e00\u6837\u7b80\u5355."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js",metastring:"// src/__tests__/index-test.js","//":!0,"src/__tests__/index-test.js":!0},"const babel = require('babel-core');\nconst plugin = require('../');\n\nvar example = `\nvar foo = 1;\nif (foo) console.log(foo);\n`;\n\nit('works', () => {\n  const {code} = babel.transform(example, {plugins: [plugin]});\n  expect(code).toMatchSnapshot();\n});\n")),(0,l.kt)("p",null,"\u8fd9\u7ed9\u4e86\u6211\u4eec\u4e00\u4e2a\u5feb\u7167\u6587\u4ef6\u5728`` src / ",(0,l.kt)("strong",{parentName:"p"}," tests ")," / ",(0,l.kt)("strong",{parentName:"p"}," snapshots ")," / index-test.js.snap "),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'exports[`test works 1`] = `\n"\nvar bar = 1;\nif (bar) console.log(bar);"\n`;\n')),(0,l.kt)("p",null,"\u5982\u679c\u6211\u4eec\u5728\u63d2\u4ef6\u4e2d\u5c06\u201cbar\u201d\u66f4\u6539\u4e3a\u201cbaz\u201d\u5e76\u518d\u6b21\u8fd0\u884c\uff0c\u5219\u53ef\u4ee5\u5f97\u5230\u4ee5\u4e0b\u7ed3\u679c\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-diff"},'\u63a5\u6536\u5230\u7684\u503c\u4e0e\u5b58\u50a8\u7684\u5feb\u71671\u4e0d\u5339\u914d\u3002\n\n    - Snapshot\n    + Received\n\n    @@ -1,3 +1,3 @@\n     "\n    -var bar = 1;\n    -if (bar) console.log(bar);"\n    +var baz = 1;\n    +if (baz) console.log(baz);"\n')),(0,l.kt)("p",null,"\u6211\u4eec\u770b\u5230\u6211\u4eec\u5bf9\u63d2\u4ef6\u4ee3\u7801\u7684\u6539\u53d8\u5982\u4f55\u5f71\u54cd\u4e86\u6211\u4eec\u63d2\u4ef6\u7684\u8f93\u51fa \u5982\u679c\u8f93\u51fa\u770b\u8d77\u6765\u4e0d\u9519\uff0c\u6211\u4eec\u53ef\u4ee5\u8fd0\u884c`jest -u \u6765\u66f4\u65b0\u5feb\u7167\u3002"),(0,l.kt)("h3",null,"AST \u6d4b\u8bd5"),(0,l.kt)("p",null,"\u9664\u4e86\u5feb\u7167\u6d4b\u8bd5\u5916\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u624b\u52a8\u68c0\u67e5AST\u3002 \u8fd9\u662f\u4e00\u4e2a\u7b80\u5355\u4f46\u662f\u8106\u5f31\u7684\u4f8b\u5b50\u3002 \u5bf9\u4e8e\u66f4\u591a\u6d89\u53ca\u7684\u60c5\u51b5\uff0c\u60a8\u53ef\u80fd\u5e0c\u671b\u5229\u7528Babel-\u904d\u5386\u3002 \u5b83\u5141\u8bb8\u60a8\u7528\u8bbf\u95ee\u8005\u952e\u6307\u5b9a\u4e00\u4e2a\u5bf9\u8c61\uff0c\u5c31\u50cf\u60a8\u4f7f\u7528\u63d2\u4ef6\u672c\u8eab\u3002"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"it('contains baz', () => {\n  const {ast} = babel.transform(example, {plugins: [plugin]});\n  const program = ast.program;\n  const declaration = program.body[0].declarations[0];\n  assert.equal(declaration.id.name, 'baz');\n  // or babelTraverse(program, {visitor: ...})\n});\n")),(0,l.kt)("h3",{id:"exec-tests"},"Exec Tests"),(0,l.kt)("p",null,"\u5728\u8fd9\u91cc\uff0c\u6211\u4eec\u5c06\u8f6c\u6362\u4ee3\u7801\uff0c\u7136\u540e\u8bc4\u4f30\u5b83\u7684\u884c\u4e3a\u662f\u5426\u6b63\u786e\u3002 \u8bf7\u6ce8\u610f\uff0c\u6211\u4eec\u5728\u6d4b\u8bd5\u4e2d\u6ca1\u6709\u4f7f\u7528``assert\u3002 \u8fd9\u786e\u4fdd\u5982\u679c\u6211\u4eec\u7684\u63d2\u4ef6\u505a\u4e86\u5947\u602a\u7684\u64cd\u4f5c\uff0c\u5982\u610f\u5916\u5220\u9664\u65ad\u8a00\u7ebf\uff0c\u4f46\u6d4b\u8bd5\u4ecd\u7136\u5931\u8d25\u3002 "),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"it('foo is an alias to baz', () => {\n  var input = `\n    var foo = 1;\n    // test that foo was renamed to baz\n    var res = baz;\n  `;\n  var {code} = babel.transform(input, {plugins: [plugin]});\n  var f = new Function(`\n    ${code};\n    return res;\n  `);\n  var res = f();\n  assert(res === 1, 'res is 1');\n});\n")),(0,l.kt)("p",null,"Babel\u6838\u5fc3\u4f7f\u7528\u7c7b\u4f3c\u7684\u65b9\u6cd5\u53bb\u83b7\u53d6\u5feb\u7167\u548c\u6267\u884c\u6d4b\u8bd5\u3002"),(0,l.kt)("h3",{id:"babel-plugin-tester"},(0,l.kt)("a",{parentName:"h3",href:"https://github.com/kentcdodds/babel-plugin-tester"},(0,l.kt)("inlineCode",{parentName:"a"},"babel-plugin-tester"))),(0,l.kt)("p",null,"\u8fd9\u4e2a\u5305\u4f7f\u6d4b\u8bd5\u63d2\u4ef6\u66f4\u5bb9\u6613\u3002 \u5982\u679c\u60a8\u719f\u6089ESLint\u7684",(0,l.kt)("a",{parentName:"p",href:"http://eslint.org/docs/developer-guide/working-with-rules#rule-unit-tests"}," RuleTester"),"\u60a8\u5e94\u8be5\u5bf9\u8fd9\u662f\u719f\u6089\u7684\u3002 \u60a8\u53ef\u4ee5\u770b\u770b",(0,l.kt)("a",{parentName:"p",href:"https://github.com/kentcdodds/babel-plugin-tester/blob/master/README.md"},"the docs"),"\u53bb\u5145\u5206\u4e86\u89e3\u53ef\u80fd\u7684\u60c5\u51b5\uff0c\u4f46\u8fd9\u91cc\u6709\u4e00\u4e2a\u7b80\u5355\u7684\u4f8b\u5b50\uff1a"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"import pluginTester from 'babel-plugin-tester';\nimport identifierReversePlugin from '../identifier-reverse-plugin';\n\npluginTester({\n  plugin: identifierReversePlugin,\n  fixtures: path.join(__dirname, '__fixtures__'),\n  tests: {\n    'does not change code with no identifiers': '\"hello\";',\n    'changes this code': {\n      code: 'var hello = \"hi\";',\n      output: 'var olleh = \"hi\";',\n    },\n    'using fixtures files': {\n      fixture: 'changed.js',\n      outputFixture: 'changed-output.js',\n    },\n    'using jest snapshots': {\n      code: `\n        function sayHi(person) {\n          return 'Hello ' + person + '!'\n        }\n      `,\n      snapshot: true,\n    },\n  },\n});\n")))}d.isMDXComponent=!0}}]);